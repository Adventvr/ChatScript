^pearl o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 2048 | 24576 | 256 $cs_token |= 1048576 | 2097152 | 4194304 | 67108864 $cs_token -= 128 $std_cstoken = $cs_token $cs_response = 32 | 65011712 $userprompt = ^"%user: >" $botprompt = ^"PEARL: " $cs_wildcardseparator = _ ^addtopic ( ~introductions ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 1 `
^pearluk o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 512 | 2048 | 24576 | 256 $std_cstoken = $cs_token $cartoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " ^addtopic ( ~introductions ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 2 `
^pearl_29_10_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 512 | 2048 | 24576 | 256 $std_cstoken = $cs_token $cartoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " ^addtopic ( ~introductions ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 4 `
^pearl_29_13_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 512 | 2048 | 24576 | 256 $std_cstoken = $cs_token $cartoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " ^addtopic ( ~introductions ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 8 `
^pearl_29_15_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 512 | 2048 | 24576 | 256 $std_cstoken = $cs_token $cartoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " ^addtopic ( ~introductions ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 16 `
^pearl_29_16_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 512 | 2048 | 24576 | 256 $cs_token -= 128 $std_cstoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARLMEMBERSHIP: " ^addtopic ( ~membership ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 32 `
^pearl_29_17_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 512 | 2048 | 24576 | 256 $std_cstoken = $cs_token $cartoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " ^addtopic ( ~introductions ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 64 `
^pearl_30_1_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 2048 | 24576 | 256 $std_cstoken = $cs_token $cartoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " ^addtopic ( ~introductions ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 128 `
^pearl_30_2_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 2048 | 24576 | 256 $std_cstoken = $cs_token $cartoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " ^addtopic ( ~introductions ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 256 `
^pearl_30_3_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 2048 | 24576 | 256 $std_cstoken = $cs_token $cartoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " ^addtopic ( ~introductions ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 512 `
^pearl_30_4_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 2048 | 24576 | 256 $std_cstoken = $cs_token $cartoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " ^addtopic ( ~introductions ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 1024 `
^pearl_30_6_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 512 | 2048 | 24576 | 256 $cs_token -= 128 $std_cstoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARLMEMBERSHIP: " ^addtopic ( ~waitingroom ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 4096 `
^pearl_31_10_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 512 | 2048 | 24576 | 256 $cs_token -= 128 $std_cstoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARLMEMBERSHIP: " ^addtopic ( ~waitingroom ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 65536 `
^pearl_31_12_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 512 | 2048 | 24576 | 256 $cs_token -= 128 $std_cstoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARLMEMBERSHIP: " ^addtopic ( ~waitingroom ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 131072 `
^pearl_31_13_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 512 | 2048 | 24576 | 256 $cs_token -= 128 $std_cstoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARLMEMBERSHIP: " ^addtopic ( ~waitingroom ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 262144 `
^pearl_31_14_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 2048 | 24576 | 256 $std_cstoken = $cs_token $cartoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " $homepage = 1 $cs_utcoffset = -7 ^addtopic ( ~homepage ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 1000 $cs_botid = 524288 `
^pearl_31_15_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 2048 | 24576 | 256 $cs_token += 67108864 | 65536 $std_cstoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " ^addtopic ( ~introductions ) $cs_control_main = ~control $cs_control_pre = ~control_pre $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 33554432 `
^pearl_31_16_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 2048 | 24576 | 256 $std_cstoken = $cs_token $cartoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " ^addtopic ( ~introductions ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 1048576 `
^pearl_31_17_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 2048 | 24576 | 256 $std_cstoken = $cs_token $cartoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " ^addtopic ( ~introductions ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 2097152 `
^pearl_31_18_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 2048 | 24576 | 256 $std_cstoken = $cs_token $cartoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " ^addtopic ( ~waitingroom ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 4194304 `
^pearl_31_19_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 2048 | 24576 | 256 $std_cstoken = $cs_token $cartoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " ^addtopic ( ~waitingroom ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 8388608 `
^pearl_31_1_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 2048 | 24576 | 256 $std_cstoken = $cs_token $cartoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " ^addtopic ( ~introductions ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 8192 `
^pearl_31_20_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 2048 | 24576 | 256 $std_cstoken = $cs_token $cartoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " ^addtopic ( ~membership ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 67108864 `
^pearl_31_21_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 2048 | 24576 | 256 $std_cstoken = $cs_token $cartoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " ^addtopic ( ~membership ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 134217728 `
^pearl_31_22_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 512 | 2048 | 24576 | 256 $std_cstoken = $cs_token $cartoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARL: " ^addtopic ( ~introductions ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 16777216 `
^pearl_31_3_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 512 | 2048 | 24576 | 256 $cs_token -= 128 $std_cstoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARLMEMBERSHIP: " ^addtopic ( ~membership ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 16384 `
^pearl_31_9_bot o 0 0 A( ) $cs_token = 70368744177664 | 4096 | 255 | 512 | 2048 | 24576 | 256 $cs_token -= 128 $std_cstoken = $cs_token $userprompt = ^"%user: >" $botprompt = ^"PEARLMEMBERSHIP: " ^addtopic ( ~waitingroom ) $cs_control_main = ~control $cs_prepass = ~xpreprocess $cs_control_post = ~xpostprocess $cs_userfactlimit = 300 $cs_botid = 32768 `
^get_techcanonical o 1 0 B( ^name ) ^if 00J( ^query ( direct_sv ^0 canonical ? 1 ) ) 00w{ ^return ( @0object ) } 00G else ( 1 ) 00q { ^return ( ^0 ) } 004 `
^getbrand o 1 0 C( ^model ^version $_vermodel $_tmp ) ^if 00a( ^1 ) 01={ $_vermodel = ^join ( ^0 _ ^1 ) $_tmp = ^query ( direct_sv $_vermodel brand ? 1 ? @4object ) ^if 00d( $_tmp ) 00t{ ^return ( $_tmp ) } 004 } 004 @1 = ^query ( direct_sv ^0 example ? ) ^if 00q( ^length ( @1 ) > 1 ) 00s{ ^return ( null ) } 004 ^if 00r( ^length ( @1 ) == 0 ) 00s{ ^return ( NULL ) } 004 ^return ( @1object ) `
^setevidence o 1 0 B( $_specialty ) ^if 00u( $_specialty == desktop ) 01J{ ^if 00A( $data.desktop.brand == Apple ) 00r{ $holder.mac = 1 } 00K else ( 1 ) 00u { $holder.laptop = 1 } 004 } 073 else 00v( $_specialty == ipcamera ) 00J{ $holder.home_security_systems = 1 } 05- else 00z( $_specialty == analogcamera ) 00J{ $holder.home_security_systems = 1 } 04~ else 00t( $_specialty == tablet ) 02!{ ^if 00E( $data.tablet.os.model == ANDROID ) 00D{ $holder.android_devices = 1 } 01M else 00A( $data.tablet.os.model == iOS ) 00r{ $holder.mac = 1 } 00T else ( 1 ) 00D { $holder.android_devices = 1 } 004 } 01E else 00t( $_specialty == laptop ) 012{ ^if 00z( $data.laptop.brand == Apple ) 00r{ $holder.mac = 1 } 004 } 004 $holder.$_specialty = 1 `
^getobviousspecialty o 1 0 C( $_brand $_model $_junk $_tmp $_special $_other $_lap $_cell $_android_devices $_tablet $_smartphones $_specialty ) $_junk = ^join ( $_brand _ $_model ) @0 = ^query ( direct_sv $_junk kindof ? ) ^if 00q( ^length ( @0 ) > 1 ) 09Y{ ^loop ( -1 ) 06t { $_tmp = ^first ( @0object ) ^if 00r( $_tmp == $specialty ) 00y{ $_special = $specialty } 004 ^if 00@( $_tmp != laptop and $_tmp != tablet and $_tmp != desktop ) 00n{ $_other = 1 } 004 ^if 00n( $_tmp == laptop ) 00q{ $_lap = laptop } 004 ^if 00r( $_tmp == cellphones ) 00m{ $_cell = 1 } 004 ^if 00w( $_tmp == android_devices ) 00x{ $_android_devices = 1 } 004 ^if 00n( $_tmp == tablet ) 00o{ $_tablet = 1 } 004 ^if 00s( $_tmp == smartphones ) 00t{ $_smartphones = 1 } 004 } ^if 00h( $_special ) 020{ ^if 00B( $specialty == android_devices ) 011{ ^if 00x( $_smartphones or $_tablet ) 00s{ ^return ( NULL ) } 004 } 004 ^return ( $_special ) } 004 ^if 00r( $_lap and ! $_other ) 00u{ ^return ( laptop ) } 004 } 00O else ( 1 ) 00y { $_specialty = @0object } 004 ^return ( $_specialty ) `
^specialtyfromproduct o 1 0 C( $_brand $_product $_index $_specialty ) $_index = ^find ( ~specialtyproducts $_product ) $_specialty = ^nth ( ~specialtymatch $_index ) ^if 014( $_specialty == camera_and_video and $specialty == home_security_systems ) 00L{ $_specialty = home_security_systems } 06Y else 00$( $_specialty == cell_phones and $specialty == phone_systems ) 00D{ $_specialty = phone_systems } 05p else 00@( $_specialty == cell_phones and $specialty == smartphones ) 00B{ $_specialty = smartphones } 03& else 00^( $_specialty == cell_phones and $specialty == android_devices ) 00B{ $_specialty = smartphones } 02y else 00T( $_specialty == cell_phones and $_brand == Apple ) 00B{ $_specialty = smartphones } 01c else 00Q( $_specialty == tv and $_brand ? ~badtvbrands ) 00q{ ^fail ( RULE ) } 004 ^return ( $_specialty ) `
^showosquestion o 1 0 A( ) ^if 00v( $data.useros == Windows ) 00u{ version of Windows } 03c else 00s( $data.useros == OS_X ) 00r{ version of OS X } 02r else 00v( $data.useros == Android ) 00u{ version of Android } 01A else 00r( $data.useros == iOS ) 00q{ version of iOS } 00R else ( 1 ) 00B { Operating System \( OS \) } 004 `
^adjustglobalbrand o 1 0 B( ^category $_head $_specialty ) ^if 00M( ^query ( direct_vo ? brand $data.brand ) ) 054{ ^loop ( -1 ) 01i { $_head = ^first ( @0subject ) ^if 00n( $_head != $data ) 00s{ ^return ( NULL ) } 004 } ^if 00m( ^0 == computer ) 00T{ $_specialty = $data.computer_specialties[0] } 018 else ( 1 ) 00% { $_specialty = $data.consumer_electronics_specialties[0] } 004 ^if 00N( $_specialty and ! $data.$_specialty.brand ) 00N{ $data.$_specialty.brand = $data.brand } 004 } 004 `
^setbrand o 1 0 C( $_variable ^brand ) ^if 00i( $_variable ) 03p{ $_variable = ^pos ( lowercase $_variable ) ^if 00q( ! $data.$_variable ) 00!{ $data.$_variable = ^jsoncreate ( PERMANENT OBJECT ) } 004 ^if 00w( ! $data.$_variable.brand ) 00D{ $data.$_variable.brand = ^1 } 004 ^setevidence ( $_variable ) } 004 ^if 00o( $_variable != os ) 00s{ $data.brand = ^1 } 004 `
^junkmodelname o 1 0 B( $_model $_word ) $_word = ^pos ( lowercase $_model ) ^if 00Y( ^pos ( isfloat $_word ) or ^pos ( isinteger $_word ) ) 00b{ } 01e else 00v( ^length ( $_model ) < 3 ) 00b{ } 00G else ( 1 ) 00q { ^fail ( CALL ) } 004 `
^branddoesspecialty o 1 0 C( $_brand $_specialty $_tmpspecialty $_specialtyremap $_special $_other $_lap $_cell $_tablet $_smartphones ) @0 = ^query ( direct_sv $_brand kindof ? ) ^loop ( -1 ) 087 { $_tmpspecialty = ^first ( @0object ) $_specialtyremap = ^query ( direct_sv $_tmpspecialty remap ? 1 ? @1object ) ^if 00-( $_specialtyremap == $_specialty or $_tmpspecialty == $_specialty ) 00C{ $_special = $_tmpspecialty } 004 ^if 01g( $_tmpspecialty != laptop and $_tmpspecialty != tablet and $_tmpspecialty != desktop ) 00n{ $_other = 1 } 004 ^if 00w( $_tmpspecialty == laptop ) 00q{ $_lap = laptop } 004 ^if 00A( $_tmpspecialty == cellphones ) 00m{ $_cell = 1 } 004 ^if 00w( $_tmpspecialty == tablet ) 00o{ $_tablet = 1 } 004 ^if 00B( $_tmpspecialty == smartphones ) 00t{ $_smartphones = 1 } 004 } ^if 00h( $_special ) 01R{ ^if 00r( $_special == tablet ) 00@{ ^if 00l( $_smartphones ) 00s{ ^return ( NULL ) } 004 } 004 ^return ( $_special ) } 004 ^fail ( CALL ) `
^safemodelnameasword o 1 0 B( $_model $_lcmodel $_bad ) $_lcmodel = ^pos ( lowercase $_model ) ^if 00C( ^pos ( ismodelnumber $_model ) ) 00b{ } 05n else 00t( $_model ? ~safemodels ) 00b{ } 04R else 00K( ^properties ( $_lcmodel ) & 1073741824 ) 00l{ $_bad = 1 } 03U else 00C( ^properties ( $_lcmodel ) & 32 ) 00l{ $_bad = 1 } 02% else 00J( ^properties ( $_lcmodel ) & 536870912 ) 00l{ $_bad = 1 } 01? else 00J( ^properties ( $_lcmodel ) & 134217728 ) 00l{ $_bad = 1 } 010 else 00J( ^properties ( $_lcmodel ) & 268435456 ) 00l{ $_bad = 1 } 004 ^if 00d( $_bad ) 02s{ ^if 00@( $specialty == software or $specialty == microsoft_office ) 00Z{ ^if 00z( $_model ? ~microsoft_office ) 00b{ } 004 } 00G else ( 1 ) 00q { ^fail ( CALL ) } 004 } 004 `
^setmodel o 1 0 D( $_variable $_model ^brand $_tmp $_unit $_os ) $_tmp = ^"model#" ^if 00F( ^extract ( $_model 0 6 ) == $_tmp ) 00N{ $_model = ^extract ( $_model 6 1000 ) } 004 ^if 00C( ^pos ( ismodelnumber $_model ) ) 00L{ $_model = ^pos ( allupper $_model ) } 004 ^if 00i( $_variable ) 032{ $_variable = ^pos ( lowercase $_variable ) ^if 00q( ! $data.$_variable ) 00!{ $data.$_variable = ^jsoncreate ( PERMANENT OBJECT ) } 004 ^if 00w( ! $data.$_variable.model ) 00I{ $data.$_variable.model = $_model } 004 } 004 ^if 00k( ! $_variable ) 00B{ $data.holdmodel = $_model } 019 else 00G( $_variable != os and ! $data.model ) 00x{ $data.model = $_model } 004 ^if 01Q( $_variable == smartphones or $_variable == tablet or $_variable == mac or $_variable == laptop or $_variable == desktop ) 0f0{ $_unit = ^join ( ^2 _ $_model ) $_os = ^query ( direct_sv $_unit use_os ? 1 ? @3object ) ^if 00c( $_os ) 0dy{ ^if 00t( ! $data.$_variable.os ) 00${ $data.$_variable.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.$_variable.os.model = $_os ^if 00i( ! $data.os ) 00T{ $data.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.os.model = $_os ^if 00n( $_os == ANDROID ) 04R{ $data.$_variable.os.brand = Google $data.os.brand = Google ^if 00z( PATTERN _ ~android_versions ) 03j{ ^if 00t( ! $data.$_variable.os ) 00${ $data.$_variable.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.$_variable.os.version = '_0 ^if 00i( ! $data.os ) 00T{ $data.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.os.version = '_0 } 004 } 05g else 00z( $_os == iOS or $_os == OS_X ) 04L{ $data.$_variable.os.brand = Apple $data.os.brand = Apple ^if 00v( PATTERN _ ~osx_versions ) 03j{ ^if 00t( ! $data.$_variable.os ) 00${ $data.$_variable.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.$_variable.os.version = '_0 ^if 00i( ! $data.os ) 00T{ $data.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.os.version = '_0 } 004 } 004 } 004 } 004 ^if 00i( $_variable ) 00D{ ^setevidence ( $_variable ) } 004 `
^legalbrandormodelname o 1 0 B( ^choice ) _3 = ^pos ( lowercase ^0 ) ^if 00Q( ^pos ( isfloat _3 ) or ^pos ( isinteger _3 ) ) 00q{ ^fail ( CALL ) } 01w else 00f( ^0 == I ) 00q{ ^fail ( CALL ) } 00Z else 00q( ^length ( ^0 ) < 3 ) 00q{ ^fail ( CALL ) } 004 `
^removeperiods o 1 0 B( $_modelx $_x ) ^nofail ( RULE $_x = ^substitute ( character $_modelx . "" ) ) ^if 00y( ^pos ( ismodelnumber $_x ) ) 012{ $_modelx = ^pos ( allupper $_modelx ) $_x = ^pos ( allupper $_x ) } 004 ^if 00o( $_x ? ~allmodels ) 00r{ ^return ( $_x ) } 004 ^return ( $_modelx ) `
^setversion o 1 0 C( $_variable ^version ) ^if 00c( ! ^1 ) 00n{ ^return ( ) } 004 $_variable = ^pos ( lowercase $_variable ) ^if 00q( ! $data.$_variable ) 00!{ $data.$_variable = ^jsoncreate ( PERMANENT OBJECT ) } 004 ^if 00y( ! $data.$_variable.version ) 00F{ $data.$_variable.version = ^1 } 004 `
^pairstartupword o 1 0 A( ) ^if 00K( PATTERN _ [ up on ] @_0- *~3 ~bootable ) 00B{ ^mark ( ~pairstartup _0 ) } 01c else 00F( PATTERN ~bootable *~3 _ [ up on ] ) 00B{ ^mark ( ~pairstartup _0 ) } 004 `
^addproblem o 1 0 B( ^problem ) ^jsonarrayinsert ( "PERMANENT UNIQUE" $data.problems ^0 ) `
^hasproblem p 1 0 B( ^problem ) ^notrace ( ^query ( direct_so $data.problems ? ^0 1 ) ) `
^findcategory o 1 0 B( ^specialty $_index $_category ) $_index = ^find ( ~specialties ^0 ) $_category = ^nth ( ~categories $_index ) ^return ( $_category ) `
^getspecialtyarray o 1 0 B( ^specialty $_category ) ^if 00g( ^0 == os ) 00n{ ^return ( ) } 00@ else 00w( ^0 == streaming_services ) 00n{ ^return ( ) } 004 $_category = ^findcategory ( ^0 ) ^if 00u( $_category == computer ) 00O{ ^return ( $data.computer_specialties ) } 013 else ( 1 ) 00~ { ^return ( $data.consumer_electronics_specialties ) } 004 `
^deletespecialty o 1 0 C( $_specialty $_limit $_specialtyarray ) $_specialty = ^pos ( lowercase $_specialty ) ^if 00Y( $_limit and ^findcategory ( $_specialty ) != $_limit ) 00s{ ^return ( null ) } 004 $_specialtyarray = ^getspecialtyarray ( $_specialty ) ^jsonarraydelete ( VALUE $_specialtyarray $_specialty ) ^if 00x( $_specialty == $specialty ) 00t{ $specialty = null } 004 `
^add2specialties o 1 0 C( ^specialty ^startup $_specialty $_array ) ^if 00c( ! ^0 ) 00n{ ^return ( ) } 004 $_specialty = ^pos ( lowercase ^0 ) $_array = null ^if 00l( ^0 == desktop ) 01N{ ^if 00A( $data.desktop.brand == Apple ) 00t{ $_specialty = mac } 00M else ( 1 ) 00w { $_specialty = laptop } 004 } 08D else 00m( ^0 == ipcamera ) 00L{ $_specialty = home_security_systems } 07E else 00q( ^0 == analogcamera ) 00L{ $_specialty = home_security_systems } 06B else 00k( ^0 == tablet ) 03p{ ^if 00E( $data.tablet.os.model == ANDROID ) 01f{ $_array = $data.consumer_electronics_specialties $_specialty = android_devices } 01y else 00A( $data.tablet.os.model == iOS ) 00t{ $_specialty = mac } 00D else ( 1 ) 00n { ^return ( ) } 004 } 02~ else 00g( ^0 == os ) 00n{ ^return ( ) } 02i else 00w( ^0 == streaming_services ) 00n{ ^return ( ) } 01x else 00k( ^0 == laptop ) 014{ ^if 00z( $data.laptop.brand == Apple ) 00t{ $_specialty = mac } 004 } 004 $_array = ^getspecialtyarray ( $_specialty ) ^if 00h( ! $_array ) 00n{ ^return ( ) } 004 ^jsonarrayinsert ( "PERMANENT UNIQUE" $_array $_specialty ) ^if 00c( ! ^1 ) 00E{ ^setevidence ( $_specialty ) } 004 ^if 00%( ^0 == smartphones and $data.smartphones.os.model == ANDROID ) 010{ ^jsonarrayinsert ( "PERMANENT UNIQUE" $_array android_devices ) } 004 `
^brandinspecialty o 1 0 B( ^brand $_brands $_brand ) $_brands = ^join ( ~ $specialty _brands ) $_brand = ^0 ^if 00T( ^query ( direct_svo $_brand member $_brands 1 ) ) 00y{ ^return ( $specialty ) } 00I else ( 1 ) 00s { ^return ( null ) } 004 `
^showitem o 1 0 B( ^item $_result $_var $_var2 $_result1 ) @0 = ^burst ( ^0 " " ) ^loop ( -1 ) 07p { $_result = null _0 = ^first ( @0subject ) _1 = ^burst ( _0 / ) ^if 00c( ! _2 ) 01T{ $_var = _1 ^if 00z( ^extract ( $_var 0 1 ) == $ ) 00t{ $_result = ^$_var } 00I else ( 1 ) 00s { $_result = $_var } 004 } 03Y else ( 1 ) 03I { $_var = _1 $_result = ^$_var ^if 00g( $_result ) 02X{ $_var = _2 ^if 00A( ^extract ( $_var2 0 1 ) == $ ) 00u{ $_result1 = ^$_var } 00J else ( 1 ) 00t { $_result1 = $_var } 004 ^if 00h( $_result1 ) 00T{ $_result = ^join ( $_result " " $_result1 ) } 004 } 004 } 004 ^if 00g( $_result ) 00w{ ^return ( $_result ) } 004 } ^return ( null ) `
^brandtable t 1 0 H( ^specialty ^brandconcept ^modelconcept ^osconcept ^brand ^model ^os $_junk $_model $_generic $_model2 $_modelconcept $_len $_version $_unit $_vermodel $_tmp ) ^addproperty ( ^4 NOUN NOUN_PROPER_SINGULAR ) ^if 00A( ^6 != * and ^3 != NO_VERSION ) 00V{ ^addproperty ( ^6 NOUN NOUN_PROPER_SINGULAR ) } 004 $_junk = ^createfact ( ^4 member ^1 ORIGINAL_ONLY ) ^if 00o( ^1 != ~os_brands ) 010{ $_junk = ^createfact ( ^4 member ~alltechbrands ORIGINAL_ONLY ) } 004 $_junk = ^createfact ( ^4 kindof ^0 ORIGINAL_ONLY ) ^if 00r( ^2 != * and ^5 != * ) 0p~{ $_model = ^5 $_generic = ^extract ( $_model 0 1 ) ^if 00m( $_generic == < ) 00N{ $_model = ^extract ( $_model 1 1000 ) } 004 _0 = ^burst ( $_model ) $_model2 = ^join ( _0 _ _1 ) $_modelconcept = ^2 ^if 00G( $_generic == < or ^3 == NO_VERSION ) 00b{ } 04o else 00x( $_model2 ? $_modelconcept ) 01${ $_len = ^length ( $_model2 ) + 1 $_version = null ^nofail ( RULE $_version = ^extract ( $_model $_len 1000 ) ) $_model = $_model2 } 01* else ( 1 ) 01S { $_len = ^length ( _0 ) + 1 $_version = null ^nofail ( RULE $_version = ^extract ( $_model $_len 1000 ) ) $_model = _0 } 004 ^if 00+( ! ^pos ( isinteger $_model ) and ! ^pos ( ismodelnumber $_model ) ) 00~{ ^addproperty ( $_model NOUN NOUN_PROPER_SINGULAR ) } 004 ^addproperty ( $_model 2305843009213693952 ) $_junk = ^join ( ^4 _ $_model ) $_junk = ^createfact ( $_junk kindof ^0 ORIGINAL_ONLY ) // this model/brand is this product $_junk = ^createfact ( $_model member ^2 ORIGINAL_ONLY ) $_junk = ^createfact ( $_model example ^4 ORIGINAL_ONLY ) ^if 00o( ^1 != ~os_brands ) 011{ $_junk = ^createfact ( $_model member ~allmodels ORIGINAL_ONLY ) } 004 ^if 00f( ^3 != * ) 01f{ $_unit = ^join ( ^4 _ $_model ) ^createfact ( $_unit use_os ^6 ORIGINAL_ONLY ) } 004 ^if 00t( $_version and $_model ) 01B{ $_vermodel = ^join ( $_model _ $_version ) $_tmp = ^createfact ( $_vermodel brand ^4 ORIGINAL_ONLY ) } 004 ^if 00S( $_version and ^pos ( ismodelnumber $_version ) ) 01*{ $_junk = ^createfact ( $_version version $_model ORIGINAL_ONLY ) $_junk = ^createfact ( $_version member ~allversions ORIGINAL_ONLY ) } 04? else 00O( $_version and ^pos ( isinteger $_version ) ) 01*{ $_junk = ^createfact ( $_version version $_model ORIGINAL_ONLY ) $_junk = ^createfact ( $_version member ~allversions ORIGINAL_ONLY ) } 02l else 00h( $_version ) 01*{ $_junk = ^createfact ( $_version version $_model ORIGINAL_ONLY ) $_junk = ^createfact ( $_version member ~allversions ORIGINAL_ONLY ) } 004 } 004 ^if 00f( ^3 != * ) 00S{ ^createfact ( ^6 member ^3 ORIGINAL_ONLY ) } 004 `
^settheme o 1 0 B( ^theme $_theme $_specialty ) $_theme = ^0 ^if 015( $_theme == SMARTPHONES-BAD_PASSWORD and $data.smartphones.brand == Apple ) 00C{ $_theme = MAC-BAD_PASSWORD } 004 ^jsonarrayinsert ( "PERMANENT UNIQUE" $data.themes $_theme ) ^if 00l( ! $data.theme ) 00x{ $data.theme = $_theme } 004 _0 = ^burst ( $_theme - ) $_specialty = ^pos ( lowercase _0 ) $holder.$_specialty = 1 `
^console_log o 1 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 1 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 1 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 1 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 1 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 1 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^getexpert o 1 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00? else ( 1 ) 00T { $_specialtyfactname = ^pos ( lowercase ^1 ) } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^getshortexpertsingular o 1 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00? else ( 1 ) 00T { $_specialtyfactname = ^pos ( lowercase ^1 ) } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^getshortexpertplural o 1 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00? else ( 1 ) 00T { $_specialtyfactname = ^pos ( lowercase ^1 ) } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { Experts } 004 `
^getexpertplural o 1 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00? else ( 1 ) 00T { $_specialtyfactname = ^pos ( lowercase ^1 ) } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { Experts } 004 `
^nextgambit o 1 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 1 0 B( ^symptom ) $symptom = ^0 ^createfact ( $symptom symptomlist x ) `
^setsymptominput o 1 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 1 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 1 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 1 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 1 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 1 0 A( $_tmp ) ^delete ( $holder ) $holder = null $data = null $symptoms = null ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 1 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 1 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^askquestion o 1 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 1 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 1 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 1 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^petreference o 1 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 1 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 1 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 1 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 1 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 1 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^setcategory o 1 0 C( ^category ^specialty ) $category = ^0 $specialty = ^1 $expert = ^getexpert ( $category $specialty ) $shortexpertsingular = ^getshortexpertsingular ( $category $specialty ) $shortexpertplural = ^getshortexpertplural ( $category $specialty ) $expertplural = ^getexpertplural ( $category $specialty ) $currentexperttopic = ^"~$category\_expert" $$assistanttitleoob = ^"assistanttitle=$expert's Assistant" $$assistanttitleoob = ^substitute ( character $$assistanttitleoob _ " " ) $$assistantnameoob = ^"assistantname=Pearl Wilson" `
^killspecialty o 1 0 A( ) ^unmark ( '_0 _0 ) $specialty = null `
^nouploademail p 1 0 A( ) [ ^hasproblem ( NoUploadEmail ) << [ unable try ~negation ~hardwareproblem ] [ attach upload send deliver forward ] >> ] `
^noviewemail p 1 0 A( ) [ ^hasproblem ( NoViewEmail ) ( << [ unable try ~negation ~hardwareproblem ] [ view see receive display show open ] >> << [ $data.email ~email_keywords =c$specialty=email mail email messages outbox ] >> ~datum_stuff ) ] `
^cantsendemail p 1 0 A( ) ( !( [ can will still ] send ) [ ^hasproblem ( CantSendEmail ) ( [ << not send error >> ( [ stuck waiting still remain pending ] *~2 outbox ) ( [ stopped no_longer not ] send ) ] << [ $data.email ~email_keywords =c$specialty=email mail email message outbox ] >> ) ] ) `
^noreceivemail p 1 0 A( ) ( !( [ can will still ] receive ) [ ^hasproblem ( NoReceiveMail ) ( [ << ~negation [ receive see get retrieve ] >> ( [ stopped no_longer ] receive ) ] << [ $data.email ~email_keywords =c$specialty=email mail email messages outbox ] >> ) ] ) `
^lostemail p 1 0 A( ) ( !( [ is_there how ] * [ 'remove 'delete erase ] ) !( [ want would_like need ] * [ 'remove 'delete erase ] ) !( not * [ 'remove 'delete erase ] ) [ ^hasproblem ( LostEmail ) [ << [ retrieve recover rescue restore look_for find ] [ trash delete erase ] >> ( get *~2 back * [ delete trash erase ] ) [ deleted trashed erased ] ( [ lose look find ] *~2 [ email mail message ] ) << [ accident accidentally unintentionally mistakenly mistake ] [ erase delete remove ] >> ] ] << [ $data.email ~email_keywords =c$specialty=email mail email messages outbox ] >> ) `
^badoverwrite p 1 0 A( ) [ ^hasproblem ( BadOverwrite ) << [ revert recover retrieve rescue save get undo ] [ $data.software.brand document doc spreadsheet sheet version file paper ] >> << [ save_over saved overwrite write_over ] [ document doc spreadsheet sheet file version paper accidentally unintentionally mistakenly ] >> ] `
^badharddrive p 1 0 A( ) [ ^hasproblem ( BadHarddrive ) ( [ << [ drive disk harddrive ] [ ~negation stop how ] [ register use work function detect read recognize connect access open appear spin come_on turn_on show_up ] >> << [ drive disk harddrive ] [ ~hardwareproblem spins read slow ] >> ] ~harddrive_stuff ) ] `
^printerbadcontrast p 1 0 A( ) [ ^hasproblem ( PrinterBadContrast ) [ << [ blank empty ] [ page sheet streak line ] >> ( !( << how black only >> ) << [ only just predominantly mainly nothing barely slightly ] [ black blue cyan magenta pink red yellow ] >> ) ( print *~2 [ line blank streak streaky ] ) ( print quality *~4 be_off ) ] ] `
^badcontrast p 1 0 A( ) [ ^hasproblem ( BadContrast ) << [ need_to how_to how_do adjust alter change modify ] ~screen >> ( [ ~screen contrast ] *~3 [ too so very ] ) << [ nothing anything blank empty streak streaky partial_letter ] [ print ~screen ] >> << [ too_much too_little invisible not_visible only just weak poor pale bad predominantly missing blur blurry inconsistent omitted mainly ~negation streak streaky faded washed_out nothing barely slightly ] [ contrast black blue white cyan magenta pink red yellow color ] >> ] `
^badpassword p 1 0 A( ) !lock_up !( ~screen *~2 be *~2 locked ) !error_code !not_locked [ ^hasproblem ( BadPassword ) ( << ~needlostforgot ~password >> ) ( << [ not_sure uncertain doubtful doubt uncertainty ] ~password >> ) [ lock_out access lock unlock get_in activate ] ( << ~hardwareproblem ~login >> ) ( << ~assistance ~login >> ) lock_out device_locked ( << ~loginrefuse [ ~password ~login ] >> ) ( not let me past ) ( not [ get sign ] [ in on into onto ] ) << ~negation ~login >> ( not get_back [ to into on in ] ) ( how *~5 [ change alter replace ] *~5 [ ~password ~login ] ) ] `
^badmouse p 1 0 A( ) [ ^hasproblem ( BadMouse ) ( [ << [ trackpad mouse trackball ] [ not unable stop how ] [ work function move connect ] >> ( !down [ trackpad mouse trackball ] *~5 ~hardwareproblem ) ( !down ~hardwareproblem *~5 [ trackpad mouse trackball ] ) ( [ trackpad mouse trackball ] *~2 broken ) ( broken *~2 [ trackpad mouse trackball ] ) ] ) ] `
^noprint p 1 0 A( ) [ ^hasproblem ( NoPrint ) << ~negation [ connect able work function print use ] [ print printer $data.printers ] >> << [ ~hardwareproblem ~assistance ] [ print printer $data.printers ] >> ] `
^nopower p 1 0 A( ) !come_on_screen !dead_pixel [ ^hasproblem ( NoPower ) ( [ ~hardwareproblem ~negation ] *~3 ~powerup ) ( [ ~hardwareproblem ~negation ] *~3 power ) died dead ( lost *~1 power ) power_off power_down ] `
^errorcode p 1 0 A( ) ( !no_error [ ^hasproblem ( ErrorCode ) ( error { : \# } [ message code state light ~number ~model_number ] ) ( [ message code error ] { be : \# } [ ~number ~modelnumber ] ) ( [ ~number ~model_number ] error ) ( [ say show have ] { a } error ) ( error say ) ] ) `
^nointernettv p 1 0 A( ) ( ![ remote volume sound audio ] [ ^hasproblem ( NoInternetTV ) << [ no not issue problem trouble ] [ connect get download load setup set run show work ] [ $data.streaming_services ~wifi $data.networking ] >> ( get *~4 [ $data.streaming_services internet ] ) ( [ no not issue problem trouble ] *~3 [ $data.streaming_services ~wifi $data.networking ] ) ] ) `
^notworkprinter p 1 0 A( ) [ << [ printer $data.printer ] [ not unable how try help ] [ connect able work function print ] >> << [ print printer $data.printer ] [ problem issue difficulty malfunction help assist assistance ] >> ( print *~2 [ nothing anything ] ) ] `
^nointernet p 1 0 A( ) [ ^hasproblem ( NoInternet ) << [ ~wifi $data.routerl ] [ not unable how difficulty ] [ work function connect get enable on ] >> << [ ~wifi $data.router ] no connection >> << [ ~wifi $data.router ] [ problem issue broken dead spotty ] >> ( no ~wifi ) offline ( get *~4 [ $data.streaming_services ~wifi ] ) ] `
^badhandset p 1 0 A( ) [ ^hasproblem ( BadHandset ) ( [ $data.phone_systems handset landline ] [ registration unregistered register connect pair ~hardwareproblem ] ) [ out_of_range dial_tone ] ] `
^badfocus p 1 0 A( ) [ ^hasproblem ( BadFocus ) << [ ~negation ~hardwareproblem try fail ] [ focus autofocus ] >> [ blurry out_of_focus unfocused ] ] `
^nosync p 1 0 A( ) [ ^hasproblem ( NoSync ) << [ ~negation ~hardwareproblem ] [ upload connect link pair recognize detect sync sink ] >> ( [ want try ] *~3 [ sync sink ] ) ] `
^noconnect p 1 0 A( ) [ ^hasproblem ( NoConnect ) ( ~negation *~3 [ connect connection ] *~2 [ with to ] ) ] `
^badlens p 1 0 A( ) [ ^hasproblem ( BadLens ) << [ retract extend lens come_out ] [ bad stuck jam error ~hardwareproblem ~negation ] >> ] `
^badcharge p 1 0 A( ) [ ^hasproblem ( BadCharge ) << [ ~negation ~hardwareproblem ] [ charge recharge ] >> ] `
^noplayertv p 1 0 A( ) [ ^hasproblem ( NoPlayerTV ) [ ( [ unable not trouble issue problem ] * [ connect link hookup hook_up ] * [ TV $data.tv ] ) << [ unable not problem issue trouble ] [ see appear view connect link hookup stream hook_up ] [ screen $data.recorders_and_players stick digital_media_player DLNA media hub server LAN HDD drive ] >> ] ] `
^frozen p 1 0 A( ) !not_locked [ ^hasproblem ( Frozen ) [ unjam unfreeze unstick stuck freeze frozen jammed ] ( not *~2 [ react respond release ] ) ( spinning *~3 [ wheel ball beachball circle symbol rainbow ] ) ( [ wheel ball beachball circle symbol rainbow ] *~3 spinning ) pinwheel RWOD ] `
^badcrash p 1 0 A( ) [ ^hasproblem ( BadCrash ) << [ crash break restarted ] >> ] `
^baderase p 1 0 A( ) !( how *~4 [ erase delete ] ) [ ^hasproblem ( BadErase ) [ erase trash throw discard ] << delete [ file attachment document text sheet version file paper ~filetype message ] >> << ~assistance [ recover retrieve restore rescue get_back ] >> ] `
^needupgrade p 1 0 A( ) [ ^hasproblem ( NeedUpgrade ) << [ 'update 'upgrade ] [ how need want try where way download not ] >> << [ 'update 'upgrade new newer newest current recent latest next last ] $data.software.brand >> << [ how need where way look ] [ new newer newest current recent latest next last ] version >> << [ need want desire ~assistance ] $data.software.brand version >> ] `
^needuninstall p 1 0 A( ) [ ^hasproblem ( NeedUninstall ) << ~deinstall [ can how need where way want try like ] >> << delete [ can how need where way want try like ] [ =c$specialty=software $data.software.brand ] >> ] `
^needprogramminghelp p 1 0 A( ) [ ^hasproblem ( NeedProgrammingHelp ) ( ~writecode *~5 ~programming_keywords ) ( $data.programming.language *~4 ~programming_keywords *~2 [ which that to in_order ] ) << [ homework assignment programming coding coursework ] [ do help how give ] >> << [ help how problem issue difficulty ] [ $data.programming.language code pseudocode ] >> ] `
^badblog p 1 0 A( ) [ ^hasproblem ( BadBlog ) [ ( [ website site vlog blog $data.hostsite content post ] *~3 [ lose crashed delete disappear dissapear disapear dissappear down not_load ] ) ( [ lose crashed delete disappear dissapear disapear dissappear down not_load ] *~3 [ website site vlog blog $data.hostsite content post ] ) << [ recover retrieve revert rescue ] [ website site vlog blog $data.hostsite content post ] >> << post [ no not unable ] [ view review see ] >> ] ] `
^cantopen p 1 0 A( ) [ ^hasproblem ( CantOpen ) ( << [ ~hardwareproblem ~negation ] [ open access pull view ] >> ) ( << ~negation [ run launch execute access open load get_in ] >> ) ] `
^badscreen p 1 0 A( ) !a_picture !take_picture !photograph !photo [ ^hasproblem ( BadScreen ) stuck_pixel ( pixel *~2 stuck ) ( ghost image ) << [ pixel pixelate digitize ] [ ~screen image picture ] >> ( << ~screen ~black >> ) ( [ no nothing ] *~4 on *~4 ~screen ) << ~negation [ display show see ] ~screen >> ( << ~screen [ ~black crack ] >> ) blacked_out ( [ no nothing ] *~4 on *~4 ~screen ) ( << ~negation [ display show see ] ~screen >> ) ( [ be went ] *~4 ~frozenscreen ) ( << [ picture image ~screen ] [ gone not_visible out ~black blacked whited_out striped blue snowy gray ] >> ) ( << ~screen ~negation light >> ) ( << ~screen [ bad distort ~hardwareproblem faded disappear go_away ~blackscreen line ] >> ) ( [ be went ] *~3 ~blackscreen ) ] `
^badvideo p 1 0 A( ) [ ^hasproblem ( BadVideo ) ( [ no not ] *~2 [ video output record picture ] ) ( camera *~2 stop [ working functioning recording ] ) ( video loss ) ] `
^missingcontroller p 1 0 A( ) [ ^hasproblem ( MissingController ) << ~tv_remote [ ~negation lose missing misplace mislay mislaid gone ate ~hardwareproblem seek want look ] >> ] `
^badsound p 1 0 A( ) !how_do !how_to !( sound { be } [ fine work ] ) !have_sound !just_sound !get_sound [ ^hasproblem ( BadSound ) ( [ hear sound audio ] *~3 [ stop_working shut_off go_out flicker muffle missing ] ) << [ hear sound audio ] ~hardwareproblem >> ( [ ~negation ] *~2 [ sound audio hear here volume ] ) ( sound *~3 tinny ) ( sound *~1 [ go fade ] *~4 [ in out ] ) [ volume mute quiet loud ] ( << [ hard ~negation buzz crackle tinny ] [ buzz buzz crackle noise ] >> ) ( [ hard ~hardwareproblem ~negation buzz crackle tinny ] *~3 [ hear audio sound buzz buzz crackle noise ] ) ( be *~3 [ loud quiet mute low ] ) ( [ volume audio sound ] *~3 be ) ( low *~2 [ sound audio ] ) ( speaker *~2 [ not stop ] *~2 [ function work ] ) ] `
^badsim p 1 0 A( ) [ ^hasproblem ( BadSIM ) ( << SIM ~negation [ recognize register provisioned valid found detect locate see ] >> ) ( << SIM [ invalid block failure lock ] >> ) ( ~negation *~2 SIM ) ] `
^legalpetname p 1 0 A( ) ! =4_0?~number ! =4_0?~pronoun ! =4_0?~interjections ! =4_0?~conjunction ! =4_0?~determiner ! =4_0?~qwords ! =5'_0=Pearl ! =4_0?~pronoun_possessive ! =5'_0=world `
^netdevicemodels p 1 0 A( ) [ $data.tv.model $data.printers.model $data.laptop.model $data.desktop.model $data.tablet.model $data.smartphones.model $data.gamesystem.model ] `
^netdevicebrands p 1 0 A( ) [ $data.tv.brand $data.printers.brand $data.laptop.brand $data.desktop.brand $data.tablet.brand $data.smartphones.brand $data.gamesystem.brand ] `
^orderthemes o 1 0 A( $_theme $_val ) ^if 00z( ^length ( $data.theme ) < 2 ) 00n{ ^return ( ) } 004 @1 = null @0 = ^query ( direct_s $data.themes ? ? ) ^loop ( -1 ) 022 { $_theme = ^first ( @0object ) $_val = 0 ^nofail ( RULE $_val = ^find ( ~themes $_theme ) ) @1 += ^createfact ( $_val x $_theme FACT_TRANSIENT ) } ^sort ( @1subject ) $data.theme = ^first ( @1object ) `
^safeword p 1 0 A( ) [ =4_0=='_0 =4_0==unknown-word =4_0?~number ^pos ( isModelNumber '_0 ) ^substitute ( character '_0 _ x fail ) ] `
^legalbrandit o 1 0 A( $_lcbrand ) $_lcbrand = ^pos ( lowercase '_10 ) ^if 00q( '_10 ? ~safebrands ) 00b{ } 07L else 00~( $specialty and ^branddoesspecialty ( '_10 $specialty ) ) 00b{ } 06I else 01p( PATTERN @_10 { model } { [ no number \# ] } _ ~allmodels ! =4_0?~number ^length ( '_10 ) > 3 ) 00b{ } 053 else 00K( ^properties ( $_lcbrand ) & 1073741824 ) 00q{ ^fail ( RULE ) } 041 else 00C( ^properties ( $_lcbrand ) & 32 ) 00q{ ^fail ( RULE ) } 037 else 00J( ^properties ( $_lcbrand ) & 134217728 ) 00q{ ^fail ( RULE ) } 026 else 00J( ^properties ( $_lcbrand ) & 536870912 ) 00q{ ^fail ( RULE ) } 015 else 00J( ^properties ( $_lcbrand ) & 268435456 ) 00q{ ^fail ( RULE ) } 004 `
^selectspecialty o 1 0 C( $_brand $_model $_junk $_len $_tmp $_x $_y ) $_junk = ^join ( $_brand _ $_model ) @0 = ^query ( direct_sv $_junk kindof ? ) $_len = ^length ( @0 ) ^if 00i( $_len == 1 ) 00w{ ^return ( @0object ) } 004 ^loop ( -1 ) 05n { $_tmp = ^first ( @0object ) ^if 00n( $_tmp == laptop ) 01h{ ^if 00L( PATTERN [ =c$specialty==laptop laptop ] ) 00u{ ^return ( laptop ) } 004 } 03m else 00o( $_tmp == desktop ) 01a{ ^if 00D( PATTERN [ desktop workstation ] ) 00v{ ^return ( desktop ) } 004 } 01W else 00n( $_tmp == tablet ) 01q{ ^if 00U( PATTERN [ =c$specialty==android_devices tablet ] ) 00u{ ^return ( tablet ) } 004 } 004 } ^if 00r( $_model == ThinkPad ) 00u{ ^return ( laptop ) } 004 ^if 00i( $_len == 2 ) 03s{ @0 = ^query ( direct_sv $_junk kindof ? ) $_x = ^first ( @0object ) $_y = ^first ( @0object ) ^if 00E( $_x == desktop and $_y == laptop ) 00u{ ^return ( laptop ) } 004 ^if 00E( $_y == desktop and $_x == laptop ) 00u{ ^return ( laptop ) } 004 } 004 ^return ( NULL ) `
^applecomputernotmobile p 1 0 A( ) ! =k$data.tablet.brand=Apple ! =p$data.smartphones.brand=Apple [ =l$data.desktop.brand==Apple =k$data.laptop.brand==Apple ] `
^applemobilenotcomputer p 1 0 A( ) [ =k$data.tablet.brand=Apple =p$data.smartphones.brand==Apple ] ! =l$data.desktop.brand=Apple ! =k$data.laptop.brand=Apple `
^notapplemobileorcomputer p 1 0 A( ) ! =k$data.tablet.brand=Apple ! =p$data.smartphones.brand=Apple ! =l$data.desktop.brand=Apple ! =k$data.laptop.brand=Apple `
^verifyemail o 1 0 A( $_mail ) $_mail = ^original ( _0 ) ^if 00N( ^substitute ( character $_mail @ x FAIL ) ) 00q{ ^fail ( call ) } 004 `
^console_log o 2 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^getexpertcapitalized o 2 0 C( ^category ^specialty ) ^if 00c( ! ^1 ) 00z{ $$specialtyfactname = * } 00Y else ( 1 ) 00I { $$specialtyfactname = $specialty } 004 $$factkey = ^join ( ^0 _ $$specialtyfactname ) ^if 00W( ^query ( direct_sv $$factkey expertcapitalized ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^get_topic_with_sufix o 2 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 2 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 2 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 2 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 2 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 2 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 2 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 2 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 2 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertsingular o 2 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertplural o 2 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^getexpertplural o 2 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^nextgambit o 2 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 2 0 B( ^symptom ) $symptom = ^0 ^createfact ( $symptom symptomlist x ) `
^hassymptom d 2 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^oob o 2 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 2 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 2 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 2 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 2 0 A( $_tmp ) ^delete ( $holder ) $holder = null $data = null $symptoms = null ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $questionprice = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 2 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $questionprice = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^askquestion o 2 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 2 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 2 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 2 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^petreference o 2 0 A( ) ^if 00v( $petname and %rand < 50 ) 00k{ $petname } 05n else 00m( $petsex == she ) 00f{ her } 04U else 00l( $petsex == he ) 00f{ him } 04f else 00g( $petname ) 00k{ $petname } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 2 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 2 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 2 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 2 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) ^if 00s( %response == $_count ) 00#{ $currentexperttopic = ~generic_expert ^nextgambit ( ) } 004 `
^car_reference o 2 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^console_log o 4 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^getexpertcapitalized o 4 0 C( ^category ^specialty ) ^if 00c( ! ^1 ) 00z{ $$specialtyfactname = * } 00Y else ( 1 ) 00I { $$specialtyfactname = $specialty } 004 $$factkey = ^join ( ^0 _ $$specialtyfactname ) ^if 00W( ^query ( direct_sv $$factkey expertcapitalized ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^get_topic_with_sufix o 4 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 4 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 4 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 4 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 4 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 4 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 4 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 4 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 4 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertsingular o 4 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertplural o 4 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^getexpertplural o 4 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^nextgambit o 4 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 4 0 B( ^symptom ) $symptom = ^0 ^createfact ( $symptom symptomlist x ) `
^hassymptom d 4 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^oob o 4 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 4 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 4 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 4 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 4 0 A( $_tmp ) ^delete ( $holder ) $holder = null $data = null $symptoms = null ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $questionprice = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 4 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $questionprice = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^askquestion o 4 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 4 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 4 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 4 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^petreference o 4 0 A( ) ^if 00v( $petname and %rand < 50 ) 00k{ $petname } 05n else 00m( $petsex == she ) 00f{ her } 04U else 00l( $petsex == he ) 00f{ him } 04f else 00g( $petname ) 00k{ $petname } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 4 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 4 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 4 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 4 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) ^if 00s( %response == $_count ) 00#{ $currentexperttopic = ~generic_expert ^nextgambit ( ) } 004 `
^car_reference o 4 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^console_log o 8 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^getexpertcapitalized o 8 0 C( ^category ^specialty ) ^if 00c( ! ^1 ) 00z{ $$specialtyfactname = * } 00Y else ( 1 ) 00I { $$specialtyfactname = $specialty } 004 $$factkey = ^join ( ^0 _ $$specialtyfactname ) ^if 00W( ^query ( direct_sv $$factkey expertcapitalized ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^get_topic_with_sufix o 8 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 8 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 8 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 8 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 8 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 8 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 8 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 8 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 8 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertsingular o 8 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertplural o 8 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^getexpertplural o 8 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^nextgambit o 8 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 8 0 B( ^symptom ) $symptom = ^0 ^createfact ( $symptom symptomlist x ) `
^hassymptom d 8 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^oob o 8 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 8 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 8 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 8 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 8 0 A( $_tmp ) ^delete ( $holder ) $holder = null $data = null $symptoms = null ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $questionprice = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 8 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $questionprice = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^askquestion o 8 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 8 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 8 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 8 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^petreference o 8 0 A( ) ^if 00v( $petname and %rand < 50 ) 00k{ $petname } 05n else 00m( $petsex == she ) 00f{ her } 04U else 00l( $petsex == he ) 00f{ him } 04f else 00g( $petname ) 00k{ $petname } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 8 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 8 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 8 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 8 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) ^if 00s( %response == $_count ) 00#{ $currentexperttopic = ~generic_expert ^nextgambit ( ) } 004 `
^car_reference o 8 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^console_log o 16 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^getexpertcapitalized o 16 0 C( ^category ^specialty ) ^if 00c( ! ^1 ) 00z{ $$specialtyfactname = * } 00Y else ( 1 ) 00I { $$specialtyfactname = $specialty } 004 $$factkey = ^join ( ^0 _ $$specialtyfactname ) ^if 00W( ^query ( direct_sv $$factkey expertcapitalized ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^get_topic_with_sufix o 16 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 16 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 16 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 16 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 16 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 16 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 16 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 16 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 16 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertsingular o 16 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertplural o 16 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^getexpertplural o 16 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^nextgambit o 16 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 16 0 B( ^symptom ) $symptom = ^0 ^createfact ( $symptom symptomlist x ) `
^hassymptom d 16 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^oob o 16 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 16 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 16 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 16 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 16 0 A( $_tmp ) ^delete ( $holder ) $holder = null $data = null $symptoms = null ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $questionprice = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 16 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $questionprice = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^askquestion o 16 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 16 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 16 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 16 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^petreference o 16 0 A( ) ^if 00v( $petname and %rand < 50 ) 00k{ $petname } 05n else 00m( $petsex == she ) 00f{ her } 04U else 00l( $petsex == he ) 00f{ him } 04f else 00g( $petname ) 00k{ $petname } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 16 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 16 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 16 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 16 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) ^if 00s( %response == $_count ) 00#{ $currentexperttopic = ~generic_expert ^nextgambit ( ) } 004 `
^car_reference o 16 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^brandtable t 32 0 H( ^specialty ^brandconcept ^modelconcept ^osconcept ^brand ^model ^os $_junk $_model $_generic $_tmp $_model2 $_modelconcept $_len $_version $_unit $_vermodel ) ^addproperty ( ^4 NOUN NOUN_PROPER_SINGULAR ) ^if 00A( ^6 != * and ^3 != NO_VERSION ) 00V{ ^addproperty ( ^6 NOUN NOUN_PROPER_SINGULAR ) } 004 $_junk = ^createfact ( ^4 member ^1 ) $_junk = ^createfact ( ^4 member ~alltechbrands ) $_junk = ^createfact ( ^4 kindof ^0 ) ^if 00r( ^2 != * and ^5 != * ) 0m${ $_model = ^5 $_generic = ^extract ( $_model 0 1 ) ^if 00m( $_generic == < ) 00N{ $_model = ^extract ( $_model 1 1000 ) } 004 _0 = ^burst ( $_model ) $_tmp = ^createfact ( _0 member ~protectedwords ) ^if 00a( _1 ) 00Z{ $_tmp = ^createfact ( _1 member ~protectedwords ) } 004 $_model2 = ^join ( _0 _ _1 ) $_modelconcept = ^2 ^if 00G( $_generic == < or ^3 == NO_VERSION ) 00b{ } 04o else 00x( $_model2 ? $_modelconcept ) 01${ $_len = ^length ( $_model2 ) + 1 $_version = null ^nofail ( RULE $_version = ^extract ( $_model $_len 1000 ) ) $_model = $_model2 } 01* else ( 1 ) 01S { $_len = ^length ( _0 ) + 1 $_version = null ^nofail ( RULE $_version = ^extract ( $_model $_len 1000 ) ) $_model = _0 } 004 ^addproperty ( $_model 2305843009213693952 ) $_junk = ^join ( ^4 _ $_model ) $_junk = ^createfact ( $_junk kindof ^0 ) // this model/brand is this product $_junk = ^createfact ( $_model member ^2 ) $_junk = ^createfact ( $_model example ^4 ) $_junk = ^createfact ( $_model member ~allmodels ) ^if 00f( ^3 != * ) 011{ $_unit = ^join ( ^4 _ $_model ) ^createfact ( $_unit use_os ^6 ) } 004 ^if 00t( $_version and $_model ) 01n{ $_vermodel = ^join ( $_model _ $_version ) $_tmp = ^createfact ( $_vermodel brand ^4 ) } 004 ^if 00S( $_version and ^pos ( ismodelnumber $_version ) ) 01G{ $_junk = ^createfact ( $_version version $_model ) $_junk = ^createfact ( $_version member ~allversions ) } 04f else 00O( $_version and ^pos ( isinteger $_version ) ) 01G{ $_junk = ^createfact ( $_version version $_model ) $_junk = ^createfact ( $_version member ~allversions ) } 01^ else 00h( $_version ) 01G{ $_junk = ^createfact ( $_version version $_model ) $_junk = ^createfact ( $_version member ~allversions ) } 004 } 004 ^if 00f( ^3 != * ) 00E{ ^createfact ( ^6 member ^3 ) } 004 `
^brandmatchspecialty o 32 0 B( ^brand $_brands $_brand ) $_brands = ^join ( ~ $specialty _brands ) $_brand = ^0 ^if 00T( ^query ( direct_svo $_brand member $_brands 1 ) ) 00y{ ^return ( $specialty ) } 00I else ( 1 ) 00s { ^return ( null ) } 004 `
^setbrand o 32 0 C( $_variable ^brand ) ^if 00i( $_variable ) 02p{ $_variable = ^pos ( lowercase $_variable ) ^if 00q( ! $data.$_variable ) 00!{ $data.$_variable = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.$_variable.brand = ^1 } 004 ^if 00o( $_variable != os ) 00s{ $data.brand = ^1 } 004 `
^setmodel o 32 0 D( $_variable ^model ^brand $_unit $_os ) ^if 00i( $_variable ) 02p{ $_variable = ^pos ( lowercase $_variable ) ^if 00q( ! $data.$_variable ) 00!{ $data.$_variable = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.$_variable.model = ^1 } 004 ^if 00o( $_variable != os ) 00s{ $data.model = ^1 } 004 ^if 01Q( $_variable == smartphones or $_variable == tablet or $_variable == mac or $_variable == laptop or $_variable == desktop ) 0e*{ $_unit = ^join ( ^2 _ ^1 ) $_os = ^query ( direct_sv $_unit use_os ? 1 ? @3object ) ^if 00c( $_os ) 0dy{ ^if 00t( ! $data.$_variable.os ) 00${ $data.$_variable.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.$_variable.os.model = $_os ^if 00i( ! $data.os ) 00T{ $data.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.os.model = $_os ^if 00n( $_os == ANDROID ) 04R{ $data.$_variable.os.brand = Google $data.os.brand = Google ^if 00z( PATTERN _ ~android_versions ) 03j{ ^if 00t( ! $data.$_variable.os ) 00${ $data.$_variable.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.$_variable.os.version = '_0 ^if 00i( ! $data.os ) 00T{ $data.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.os.version = '_0 } 004 } 05g else 00z( $_os == iOS or $_os == OS_X ) 04L{ $data.$_variable.os.brand = Apple $data.os.brand = Apple ^if 00v( PATTERN _ ~osx_versions ) 03j{ ^if 00t( ! $data.$_variable.os ) 00${ $data.$_variable.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.$_variable.os.version = '_0 ^if 00i( ! $data.os ) 00T{ $data.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.os.version = '_0 } 004 } 004 } 004 } 004 `
^getbrand o 32 0 C( ^model ^version $_vermodel $_tmp ) ^if 00a( ^1 ) 01={ $_vermodel = ^join ( ^0 _ ^1 ) $_tmp = ^query ( direct_sv $_vermodel brand ? 1 ? @4object ) ^if 00d( $_tmp ) 00t{ ^return ( $_tmp ) } 004 } 004 @1 = ^query ( direct_sv ^0 example ? ) ^if 00q( ^length ( @1 ) > 1 ) 00s{ ^return ( null ) } 004 ^if 00r( ^length ( @1 ) == 0 ) 00s{ ^return ( NULL ) } 004 ^return ( @1object ) `
^legalbrandormodelname o 32 0 B( ^choice ) _3 = ^pos ( lowercase ^0 ) ^if 00Q( ^pos ( isfloat _3 ) or ^pos ( isinteger _3 ) ) 00q{ ^fail ( CALL ) } 01w else 00f( ^0 == I ) 00q{ ^fail ( CALL ) } 00Z else 00q( ^length ( ^0 ) < 3 ) 00q{ ^fail ( CALL ) } 004 `
^removeperiods o 32 0 B( $_modelx $_x ) $_x = ^substitute ( character $_modelx . "" ) ^if 00y( ^pos ( ismodelnumber $_x ) ) 00D{ $_x = ^pos ( allupper $_x ) } 004 ^if 00o( $_x ? ~allmodels ) 00r{ ^return ( $_x ) } 004 ^return ( $_modelx ) `
^setversion o 32 0 C( $_variable ^version ) ^if 00c( ! ^1 ) 00n{ ^return ( ) } 004 $_variable = ^pos ( lowercase $_variable ) ^if 00q( ! $data.$_variable ) 00!{ $data.$_variable = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.$_variable.version = ^1 `
^console_log o 32 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 32 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 32 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 32 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 32 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 32 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 32 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 32 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 32 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 32 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertsingular o 32 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertplural o 32 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^getexpertplural o 32 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^nextgambit o 32 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 01+{ ^if 00u( $chattype == dashboard ) 00z{ ^gambit ( ~membership ) } 00- else ( 1 ) 00U { ^gambit_safe ( $currentexperttopic $source ) } 004 } 004 `
^setsymptom o 32 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 32 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 32 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 32 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 32 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 32 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 32 0 A( $_tmp ) ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 32 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 32 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 32 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 32 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 32 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 32 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 32 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 32 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 32 0 A( ) ^if 00v( $petname and %rand < 50 ) 00k{ $petname } 05n else 00m( $petsex == she ) 00f{ her } 04U else 00l( $petsex == he ) 00f{ him } 04f else 00g( $petname ) 00k{ $petname } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 32 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 32 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 32 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 32 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) ^if 00s( %response == $_count ) 00#{ $currentexperttopic = ~generic_expert ^nextgambit ( ) } 004 `
^car_reference o 32 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^safeword p 32 0 A( ) [ =4_0=='_0 =4_0==unknown-word ^substitute ( character '_0 _ x fail ) ] `
^selectambiguous o 32 0 B( ^model $_tmp ) ^loop ( -1 ) 05J { $_tmp = ^first ( @0object ) ^if 00n( $_tmp == laptop ) 01h{ ^if 00L( PATTERN [ =c$specialty==laptop laptop ] ) 00u{ ^return ( laptop ) } 004 } 03I else 00o( $_tmp == desktop ) 01w{ ^if 00Z( PATTERN [ ! =c$specialty=laptop desktop workstation ] ) 00v{ ^return ( desktop ) } 004 } 01W else 00n( $_tmp == tablet ) 01q{ ^if 00U( PATTERN [ =c$specialty==android_devices tablet ] ) 00u{ ^return ( tablet ) } 004 } 004 } ^if 00m( ^0 == ThinkPad ) 00u{ ^return ( laptop ) } 004 ^return ( NULL ) `
^console_log o 64 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^getexpertcapitalized o 64 0 C( ^category ^specialty ) ^if 00c( ! ^1 ) 00z{ $$specialtyfactname = * } 00Y else ( 1 ) 00I { $$specialtyfactname = $specialty } 004 $$factkey = ^join ( ^0 _ $$specialtyfactname ) ^if 00W( ^query ( direct_sv $$factkey expertcapitalized ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^get_topic_with_sufix o 64 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 64 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 64 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 64 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 64 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 64 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 64 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 64 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 64 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertsingular o 64 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertplural o 64 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^getexpertplural o 64 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^nextgambit o 64 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 64 0 B( ^symptom ) $symptom = ^0 ^createfact ( $symptom symptomlist x ) `
^hassymptom d 64 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^oob o 64 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 64 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 64 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 64 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 64 0 A( $_tmp ) ^delete ( $holder ) $holder = null $data = null $symptoms = null ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $questionprice = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 64 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $questionprice = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^askquestion o 64 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 64 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 64 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 64 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^petreference o 64 0 A( ) ^if 00v( $petname and %rand < 50 ) 00k{ $petname } 05n else 00m( $petsex == she ) 00f{ her } 04U else 00l( $petsex == he ) 00f{ him } 04f else 00g( $petname ) 00k{ $petname } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 64 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 64 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 64 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 64 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) ^if 00s( %response == $_count ) 00#{ $currentexperttopic = ~generic_expert ^nextgambit ( ) } 004 `
^car_reference o 64 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^console_log o 128 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 128 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 128 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 128 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 128 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 128 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 128 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 128 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 128 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 128 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertsingular o 128 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertplural o 128 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^getexpertplural o 128 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^nextgambit o 128 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 128 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 128 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 128 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 128 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 128 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 128 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 128 0 A( $_tmp ) ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 128 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 128 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 128 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 128 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 128 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 128 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 128 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 128 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 128 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 128 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 128 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 128 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 128 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 128 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^console_log o 256 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 256 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 256 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 256 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 256 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 256 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 256 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 256 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 256 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 256 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Q else ( 1 ) 00A { $_specialtyfactname = ^1 } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertsingular o 256 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Q else ( 1 ) 00A { $_specialtyfactname = ^1 } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertplural o 256 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Q else ( 1 ) 00A { $_specialtyfactname = ^1 } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^getexpertplural o 256 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Q else ( 1 ) 00A { $_specialtyfactname = ^1 } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^nextgambit o 256 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 256 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 256 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 256 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 256 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 256 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 256 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 256 0 A( $_tmp ) ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 256 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 256 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 256 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 256 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 256 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 256 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 256 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 256 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 256 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 256 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 256 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 256 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 256 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 256 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^console_log o 512 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 512 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 512 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 512 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 512 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 512 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 512 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 512 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 512 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 512 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertsingular o 512 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertplural o 512 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^getexpertplural o 512 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^nextgambit o 512 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 512 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 512 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 512 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 512 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 512 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 512 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 512 0 A( $_tmp ) ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 512 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 512 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 512 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 512 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 512 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 512 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 512 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 512 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 512 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 512 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 512 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 512 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 512 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 512 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^expertnamex o 1024 0 B( $_nocredentials $_expert_name $_expert_title ) ^if 01g( ^query ( direct_s "^^join(30_4_experts _ $category _ $specialty _ $location)" ? ? ) ) 00Y{ $_expert_name = @0verb $_expert_title = @0object } 05! else 018( ^query ( direct_s "^^join(30_4_experts _ $category _ $specialty _ *)" ? ? ) ) 00Y{ $_expert_name = @0verb $_expert_title = @0object } 03# else 017( ^query ( direct_s "^^join(30_4_experts _ $category _ * _ $location)" ? ? ) ) 00Y{ $_expert_name = @0verb $_expert_title = @0object } 01^ else 00=( ^query ( direct_s "^^join(30_4_experts _ $category _ * _ *)" ? ? ) ) 00Y{ $_expert_name = @0verb $_expert_title = @0object } 004 $_expert_name ^if 00p( ! $_nocredentials ) 00w{ \( $_expert_title \) } 004 `
^console_log o 1024 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 1024 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 1024 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 1024 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 1024 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 1024 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 1024 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 1024 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 1024 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 1024 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertsingular o 1024 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertplural o 1024 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^getexpertplural o 1024 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^nextgambit o 1024 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 1024 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 1024 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 1024 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 1024 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 1024 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 1024 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 1024 0 A( $_tmp ) ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 1024 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 1024 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 1024 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 1024 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 1024 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 1024 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 1024 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 1024 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 1024 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 1024 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 1024 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 1024 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 1024 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 1024 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^brandtable t 4096 0 H( ^specialty ^brandconcept ^modelconcept ^osconcept ^brand ^model ^os $_junk $_model $_generic $_tmp $_model2 $_modelconcept $_len $_version $_unit $_vermodel ) ^addproperty ( ^4 NOUN NOUN_PROPER_SINGULAR ) ^if 00A( ^6 != * and ^3 != NO_VERSION ) 00V{ ^addproperty ( ^6 NOUN NOUN_PROPER_SINGULAR ) } 004 $_junk = ^createfact ( ^4 member ^1 ) $_junk = ^createfact ( ^4 member ~alltechbrands ) $_junk = ^createfact ( ^4 kindof ^0 ) ^if 00r( ^2 != * and ^5 != * ) 0m${ $_model = ^5 $_generic = ^extract ( $_model 0 1 ) ^if 00m( $_generic == < ) 00N{ $_model = ^extract ( $_model 1 1000 ) } 004 _0 = ^burst ( $_model ) $_tmp = ^createfact ( _0 member ~protectedwords ) ^if 00a( _1 ) 00Z{ $_tmp = ^createfact ( _1 member ~protectedwords ) } 004 $_model2 = ^join ( _0 _ _1 ) $_modelconcept = ^2 ^if 00G( $_generic == < or ^3 == NO_VERSION ) 00b{ } 04o else 00x( $_model2 ? $_modelconcept ) 01${ $_len = ^length ( $_model2 ) + 1 $_version = null ^nofail ( RULE $_version = ^extract ( $_model $_len 1000 ) ) $_model = $_model2 } 01* else ( 1 ) 01S { $_len = ^length ( _0 ) + 1 $_version = null ^nofail ( RULE $_version = ^extract ( $_model $_len 1000 ) ) $_model = _0 } 004 ^addproperty ( $_model 2305843009213693952 ) $_junk = ^join ( ^4 _ $_model ) $_junk = ^createfact ( $_junk kindof ^0 ) // this model/brand is this product $_junk = ^createfact ( $_model member ^2 ) $_junk = ^createfact ( $_model example ^4 ) $_junk = ^createfact ( $_model member ~allmodels ) ^if 00f( ^3 != * ) 011{ $_unit = ^join ( ^4 _ $_model ) ^createfact ( $_unit use_os ^6 ) } 004 ^if 00t( $_version and $_model ) 01n{ $_vermodel = ^join ( $_model _ $_version ) $_tmp = ^createfact ( $_vermodel brand ^4 ) } 004 ^if 00S( $_version and ^pos ( ismodelnumber $_version ) ) 01G{ $_junk = ^createfact ( $_version version $_model ) $_junk = ^createfact ( $_version member ~allversions ) } 04f else 00O( $_version and ^pos ( isinteger $_version ) ) 01G{ $_junk = ^createfact ( $_version version $_model ) $_junk = ^createfact ( $_version member ~allversions ) } 01^ else 00h( $_version ) 01G{ $_junk = ^createfact ( $_version version $_model ) $_junk = ^createfact ( $_version member ~allversions ) } 004 } 004 ^if 00f( ^3 != * ) 00E{ ^createfact ( ^6 member ^3 ) } 004 `
^brandmatchspecialty o 4096 0 B( ^brand $_brands $_brand ) $_brands = ^join ( ~ $specialty _brands ) $_brand = ^0 ^if 00T( ^query ( direct_svo $_brand member $_brands 1 ) ) 00y{ ^return ( $specialty ) } 00I else ( 1 ) 00s { ^return ( null ) } 004 `
^setbrand o 4096 0 C( $_variable ^brand ) ^if 00i( $_variable ) 02p{ $_variable = ^pos ( lowercase $_variable ) ^if 00q( ! $data.$_variable ) 00!{ $data.$_variable = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.$_variable.brand = ^1 } 004 ^if 00o( $_variable != os ) 00s{ $data.brand = ^1 } 004 `
^setmodel o 4096 0 D( $_variable ^model ^brand $_unit $_os ) ^if 00i( $_variable ) 02p{ $_variable = ^pos ( lowercase $_variable ) ^if 00q( ! $data.$_variable ) 00!{ $data.$_variable = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.$_variable.model = ^1 } 004 ^if 00o( $_variable != os ) 00s{ $data.model = ^1 } 004 ^if 01Q( $_variable == smartphones or $_variable == tablet or $_variable == mac or $_variable == laptop or $_variable == desktop ) 0e*{ $_unit = ^join ( ^2 _ ^1 ) $_os = ^query ( direct_sv $_unit use_os ? 1 ? @3object ) ^if 00c( $_os ) 0dy{ ^if 00t( ! $data.$_variable.os ) 00${ $data.$_variable.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.$_variable.os.model = $_os ^if 00i( ! $data.os ) 00T{ $data.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.os.model = $_os ^if 00n( $_os == ANDROID ) 04R{ $data.$_variable.os.brand = Google $data.os.brand = Google ^if 00z( PATTERN _ ~android_versions ) 03j{ ^if 00t( ! $data.$_variable.os ) 00${ $data.$_variable.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.$_variable.os.version = '_0 ^if 00i( ! $data.os ) 00T{ $data.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.os.version = '_0 } 004 } 05g else 00z( $_os == iOS or $_os == OS_X ) 04L{ $data.$_variable.os.brand = Apple $data.os.brand = Apple ^if 00v( PATTERN _ ~osx_versions ) 03j{ ^if 00t( ! $data.$_variable.os ) 00${ $data.$_variable.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.$_variable.os.version = '_0 ^if 00i( ! $data.os ) 00T{ $data.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.os.version = '_0 } 004 } 004 } 004 } 004 `
^getbrand o 4096 0 C( ^model ^version $_vermodel $_tmp ) ^if 00a( ^1 ) 01={ $_vermodel = ^join ( ^0 _ ^1 ) $_tmp = ^query ( direct_sv $_vermodel brand ? 1 ? @4object ) ^if 00d( $_tmp ) 00t{ ^return ( $_tmp ) } 004 } 004 @1 = ^query ( direct_sv ^0 example ? ) ^if 00q( ^length ( @1 ) > 1 ) 00s{ ^return ( null ) } 004 ^if 00r( ^length ( @1 ) == 0 ) 00s{ ^return ( NULL ) } 004 ^return ( @1object ) `
^legalbrandormodelname o 4096 0 B( ^choice ) _3 = ^pos ( lowercase ^0 ) ^if 00Q( ^pos ( isfloat _3 ) or ^pos ( isinteger _3 ) ) 00q{ ^fail ( CALL ) } 01w else 00f( ^0 == I ) 00q{ ^fail ( CALL ) } 00Z else 00q( ^length ( ^0 ) < 3 ) 00q{ ^fail ( CALL ) } 004 `
^removeperiods o 4096 0 B( $_modelx $_x ) $_x = ^substitute ( character $_modelx . "" ) ^if 00y( ^pos ( ismodelnumber $_x ) ) 00D{ $_x = ^pos ( allupper $_x ) } 004 ^if 00o( $_x ? ~allmodels ) 00r{ ^return ( $_x ) } 004 ^return ( $_modelx ) `
^setversion o 4096 0 C( $_variable ^version ) ^if 00c( ! ^1 ) 00n{ ^return ( ) } 004 $_variable = ^pos ( lowercase $_variable ) ^if 00q( ! $data.$_variable ) 00!{ $data.$_variable = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.$_variable.version = ^1 `
^console_log o 4096 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 4096 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 4096 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 4096 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 4096 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 4096 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 4096 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 4096 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 4096 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 4096 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertsingular o 4096 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertplural o 4096 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^getexpertplural o 4096 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^nextgambit o 4096 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 021{ ^if 00w( $chattype == waitingroom ) 00A{ ^gambit ( ~waitingroom ) } 00- else ( 1 ) 00U { ^gambit_safe ( $currentexperttopic $source ) } 004 } 004 `
^setsymptom o 4096 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 4096 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 4096 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 4096 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 4096 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 4096 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 4096 0 A( $_tmp ) ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 4096 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 4096 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 4096 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 4096 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 4096 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 4096 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 4096 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 4096 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 4096 0 A( ) ^if 00v( $petname and %rand < 50 ) 00k{ $petname } 05n else 00m( $petsex == she ) 00f{ her } 04U else 00l( $petsex == he ) 00f{ him } 04f else 00g( $petname ) 00k{ $petname } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 4096 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 4096 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 4096 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 4096 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) ^if 00s( %response == $_count ) 00#{ $currentexperttopic = ~generic_expert ^nextgambit ( ) } 004 `
^car_reference o 4096 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^safeword p 4096 0 A( ) [ =4_0=='_0 =4_0==unknown-word ^substitute ( character '_0 _ x fail ) ] `
^selectambiguous o 4096 0 B( ^model $_tmp ) ^loop ( -1 ) 05J { $_tmp = ^first ( @0object ) ^if 00n( $_tmp == laptop ) 01h{ ^if 00L( PATTERN [ =c$specialty==laptop laptop ] ) 00u{ ^return ( laptop ) } 004 } 03I else 00o( $_tmp == desktop ) 01w{ ^if 00Z( PATTERN [ ! =c$specialty=laptop desktop workstation ] ) 00v{ ^return ( desktop ) } 004 } 01W else 00n( $_tmp == tablet ) 01q{ ^if 00U( PATTERN [ =c$specialty==android_devices tablet ] ) 00u{ ^return ( tablet ) } 004 } 004 } ^if 00m( ^0 == ThinkPad ) 00u{ ^return ( laptop ) } 004 ^return ( NULL ) `
^console_log o 65536 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 65536 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 65536 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 65536 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 65536 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 65536 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 65536 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 65536 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 65536 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 65536 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertsingular o 65536 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertplural o 65536 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^getexpertplural o 65536 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^nextgambit o 65536 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 021{ ^if 00w( $chattype == waitingroom ) 00A{ ^gambit ( ~waitingroom ) } 00- else ( 1 ) 00U { ^gambit_safe ( $currentexperttopic $source ) } 004 } 004 `
^setsymptom o 65536 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 65536 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 65536 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 65536 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 65536 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 65536 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 65536 0 A( $_tmp ) ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 65536 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 65536 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 65536 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 65536 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 65536 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 65536 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 65536 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 65536 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 65536 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 65536 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 65536 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 65536 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 65536 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 65536 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^console_log o 131072 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 131072 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 131072 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 131072 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 131072 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 131072 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 131072 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 131072 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 131072 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 131072 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertsingular o 131072 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertplural o 131072 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^getexpertplural o 131072 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^nextgambit o 131072 0 A( ) ^if 00u( $chattype == dashboard ) 00z{ ^gambit ( ~membership ) } 01s else 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 131072 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 131072 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 131072 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 131072 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 131072 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 131072 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 131072 0 A( $_tmp ) ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 131072 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 131072 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 131072 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 131072 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 131072 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 131072 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 131072 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 131072 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 131072 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 131072 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 131072 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 131072 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 131072 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 131072 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^console_log o 262144 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 262144 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 262144 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 262144 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 262144 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 262144 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 262144 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 262144 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 262144 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 262144 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertsingular o 262144 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertplural o 262144 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^getexpertplural o 262144 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^nextgambit o 262144 0 A( ) ^if 00u( $chattype == dashboard ) 00z{ ^gambit ( ~membership ) } 01s else 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 262144 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 262144 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 262144 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 262144 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 262144 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 262144 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 262144 0 A( $_tmp ) ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 262144 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 262144 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 262144 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 262144 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 262144 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 262144 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 262144 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 262144 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 262144 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 262144 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 262144 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 262144 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 262144 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 262144 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^determine o 524288 0 B( ^word $_tmp ) $_tmp = ^pos ( LOWERCASE ^0 ) $_tmp = ^extract ( $_tmp 0 1 ) ^if 00=( $_tmp == a or $_tmp == e or $_tmp == i or $_tmp == o or $_tmp == u ) 00m{ $_tmp = an } 00B else ( 1 ) 00l { $_tmp = a } 004 ^return ( ^join ( $_tmp " " ^0 ) ) `
^setevidence o 524288 0 B( $_specialty ) ^if 00u( $_specialty == desktop ) 01J{ ^if 00A( $data.desktop.brand == Apple ) 00r{ $holder.mac = 1 } 00K else ( 1 ) 00u { $holder.laptop = 1 } 004 } 073 else 00v( $_specialty == ipcamera ) 00J{ $holder.home_security_systems = 1 } 05- else 00z( $_specialty == analogcamera ) 00J{ $holder.home_security_systems = 1 } 04~ else 00t( $_specialty == tablet ) 02!{ ^if 00E( $data.tablet.os.model == ANDROID ) 00D{ $holder.android_devices = 1 } 01M else 00A( $data.tablet.os.model == iOS ) 00r{ $holder.mac = 1 } 00T else ( 1 ) 00D { $holder.android_devices = 1 } 004 } 01E else 00t( $_specialty == laptop ) 012{ ^if 00z( $data.laptop.brand == Apple ) 00r{ $holder.mac = 1 } 004 } 004 $holder.$_specialty = 1 `
^getobviousspecialty o 524288 0 C( $_brand $_model $_junk $_tmp $_special $_other $_lap $_cell $_android_devices $_tablet $_smartphones $_specialty ) $_junk = ^join ( $_brand _ $_model ) @0 = ^query ( direct_sv $_junk kindof ? ) ^if 00q( ^length ( @0 ) > 1 ) 09Y{ ^loop ( -1 ) 06t { $_tmp = ^first ( @0object ) ^if 00r( $_tmp == $specialty ) 00y{ $_special = $specialty } 004 ^if 00@( $_tmp != laptop and $_tmp != tablet and $_tmp != desktop ) 00n{ $_other = 1 } 004 ^if 00n( $_tmp == laptop ) 00q{ $_lap = laptop } 004 ^if 00r( $_tmp == cellphones ) 00m{ $_cell = 1 } 004 ^if 00w( $_tmp == android_devices ) 00x{ $_android_devices = 1 } 004 ^if 00n( $_tmp == tablet ) 00o{ $_tablet = 1 } 004 ^if 00s( $_tmp == smartphones ) 00t{ $_smartphones = 1 } 004 } ^if 00h( $_special ) 020{ ^if 00B( $specialty == android_devices ) 011{ ^if 00x( $_smartphones or $_tablet ) 00s{ ^return ( NULL ) } 004 } 004 ^return ( $_special ) } 004 ^if 00r( $_lap and ! $_other ) 00u{ ^return ( laptop ) } 004 } 00O else ( 1 ) 00y { $_specialty = @0object } 004 ^return ( $_specialty ) `
^specialtyfromproduct o 524288 0 C( $_brand $_product $_index $_specialty ) $_index = ^find ( ~specialtyproducts $_product ) $_specialty = ^nth ( ~specialtymatch $_index ) ^if 014( $_specialty == camera_and_video and $specialty == home_security_systems ) 00L{ $_specialty = home_security_systems } 06Y else 00$( $_specialty == cell_phones and $specialty == phone_systems ) 00D{ $_specialty = phone_systems } 05p else 00@( $_specialty == cell_phones and $specialty == smartphones ) 00B{ $_specialty = smartphones } 03& else 00^( $_specialty == cell_phones and $specialty == android_devices ) 00B{ $_specialty = smartphones } 02y else 00T( $_specialty == cell_phones and $_brand == Apple ) 00B{ $_specialty = smartphones } 01c else 00Q( $_specialty == tv and $_brand ? ~badtvbrands ) 00q{ ^fail ( RULE ) } 004 ^return ( $_specialty ) `
^showosquestion o 524288 0 A( ) ^if 00v( $data.useros == Windows ) 00u{ version of Windows } 03c else 00s( $data.useros == OS_X ) 00r{ version of OS X } 02r else 00v( $data.useros == Android ) 00u{ version of Android } 01A else 00r( $data.useros == iOS ) 00q{ version of iOS } 00R else ( 1 ) 00B { Operating System \( OS \) } 004 `
^adjustglobalbrand o 524288 0 B( ^category $_head $_specialty ) ^if 00M( ^query ( direct_vo ? brand $data.brand ) ) 054{ ^loop ( -1 ) 01i { $_head = ^first ( @0subject ) ^if 00n( $_head != $data ) 00s{ ^return ( NULL ) } 004 } ^if 00m( ^0 == computer ) 00T{ $_specialty = $data.computer_specialties[0] } 018 else ( 1 ) 00% { $_specialty = $data.consumer_electronics_specialties[0] } 004 ^if 00N( $_specialty and ! $data.$_specialty.brand ) 00N{ $data.$_specialty.brand = $data.brand } 004 } 004 `
^setbrand o 524288 0 C( $_variable ^brand ) ^if 00i( $_variable ) 03p{ $_variable = ^pos ( lowercase $_variable ) ^if 00q( ! $data.$_variable ) 00!{ $data.$_variable = ^jsoncreate ( PERMANENT OBJECT ) } 004 ^if 00w( ! $data.$_variable.brand ) 00D{ $data.$_variable.brand = ^1 } 004 ^setevidence ( $_variable ) } 004 ^if 00o( $_variable != os ) 00s{ $data.brand = ^1 } 004 `
^junkmodelname o 524288 0 B( $_model $_word ) $_word = ^pos ( lowercase $_model ) ^if 00Y( ^pos ( isfloat $_word ) or ^pos ( isinteger $_word ) ) 00b{ } 01e else 00v( ^length ( $_model ) < 3 ) 00b{ } 00G else ( 1 ) 00q { ^fail ( CALL ) } 004 `
^branddoesspecialty o 524288 0 C( $_brand $_specialty $_tmpspecialty $_specialtyremap $_special $_other $_lap $_cell $_tablet $_smartphones ) @0 = ^query ( direct_sv $_brand kindof ? ) ^loop ( -1 ) 087 { $_tmpspecialty = ^first ( @0object ) $_specialtyremap = ^query ( direct_sv $_tmpspecialty remap ? 1 ? @1object ) ^if 00-( $_specialtyremap == $_specialty or $_tmpspecialty == $_specialty ) 00C{ $_special = $_tmpspecialty } 004 ^if 01g( $_tmpspecialty != laptop and $_tmpspecialty != tablet and $_tmpspecialty != desktop ) 00n{ $_other = 1 } 004 ^if 00w( $_tmpspecialty == laptop ) 00q{ $_lap = laptop } 004 ^if 00A( $_tmpspecialty == cellphones ) 00m{ $_cell = 1 } 004 ^if 00w( $_tmpspecialty == tablet ) 00o{ $_tablet = 1 } 004 ^if 00B( $_tmpspecialty == smartphones ) 00t{ $_smartphones = 1 } 004 } ^if 00h( $_special ) 01R{ ^if 00r( $_special == tablet ) 00@{ ^if 00l( $_smartphones ) 00s{ ^return ( NULL ) } 004 } 004 ^return ( $_special ) } 004 ^fail ( CALL ) `
^safemodelnameasword o 524288 0 B( $_model $_lcmodel $_bad ) $_lcmodel = ^pos ( lowercase $_model ) ^if 00C( ^pos ( ismodelnumber $_model ) ) 00b{ } 06v else 00t( $_model ? ~safemodels ) 00b{ } 05Z else 00K( ^properties ( $_lcmodel ) & 1073741824 ) 01t{ ^if 00J( ^properties ( $_lcmodel ) & 536870912 ) 00b{ } 00B else ( 1 ) 00l { $_bad = 1 } 004 } 03U else 00C( ^properties ( $_lcmodel ) & 32 ) 00l{ $_bad = 1 } 02% else 00J( ^properties ( $_lcmodel ) & 536870912 ) 00l{ $_bad = 1 } 01? else 00J( ^properties ( $_lcmodel ) & 134217728 ) 00l{ $_bad = 1 } 010 else 00J( ^properties ( $_lcmodel ) & 268435456 ) 00l{ $_bad = 1 } 004 ^if 00d( $_bad ) 02s{ ^if 00@( $specialty == software or $specialty == microsoft_office ) 00Z{ ^if 00z( $_model ? ~microsoft_office ) 00b{ } 004 } 00G else ( 1 ) 00q { ^fail ( CALL ) } 004 } 004 `
^setmodel o 524288 0 D( $_variable $_model ^brand $_tmp $_unit $_os ) $_tmp = ^"model#" ^if 00F( ^extract ( $_model 0 6 ) == $_tmp ) 00N{ $_model = ^extract ( $_model 6 1000 ) } 004 ^if 00C( ^pos ( ismodelnumber $_model ) ) 00L{ $_model = ^pos ( allupper $_model ) } 004 ^if 00i( $_variable ) 032{ $_variable = ^pos ( lowercase $_variable ) ^if 00q( ! $data.$_variable ) 00!{ $data.$_variable = ^jsoncreate ( PERMANENT OBJECT ) } 004 ^if 00w( ! $data.$_variable.model ) 00I{ $data.$_variable.model = $_model } 004 } 004 ^if 00k( ! $_variable ) 00B{ $data.holdmodel = $_model } 019 else 00G( $_variable != os and ! $data.model ) 00x{ $data.model = $_model } 004 ^if 01Q( $_variable == smartphones or $_variable == tablet or $_variable == mac or $_variable == laptop or $_variable == desktop ) 0f0{ $_unit = ^join ( ^2 _ $_model ) $_os = ^query ( direct_sv $_unit use_os ? 1 ? @3object ) ^if 00c( $_os ) 0dy{ ^if 00t( ! $data.$_variable.os ) 00${ $data.$_variable.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.$_variable.os.model = $_os ^if 00i( ! $data.os ) 00T{ $data.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.os.model = $_os ^if 00n( $_os == ANDROID ) 04R{ $data.$_variable.os.brand = Google $data.os.brand = Google ^if 00z( PATTERN _ ~android_versions ) 03j{ ^if 00t( ! $data.$_variable.os ) 00${ $data.$_variable.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.$_variable.os.version = '_0 ^if 00i( ! $data.os ) 00T{ $data.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.os.version = '_0 } 004 } 05g else 00z( $_os == iOS or $_os == OS_X ) 04L{ $data.$_variable.os.brand = Apple $data.os.brand = Apple ^if 00v( PATTERN _ ~osx_versions ) 03j{ ^if 00t( ! $data.$_variable.os ) 00${ $data.$_variable.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.$_variable.os.version = '_0 ^if 00i( ! $data.os ) 00T{ $data.os = ^jsoncreate ( PERMANENT OBJECT ) } 004 $data.os.version = '_0 } 004 } 004 } 004 } 004 ^if 00i( $_variable ) 00D{ ^setevidence ( $_variable ) } 004 `
^legalbrandormodelname o 524288 0 B( ^choice ) _3 = ^pos ( lowercase ^0 ) ^if 00Q( ^pos ( isfloat _3 ) or ^pos ( isinteger _3 ) ) 00q{ ^fail ( CALL ) } 01w else 00f( ^0 == I ) 00q{ ^fail ( CALL ) } 00Z else 00q( ^length ( ^0 ) < 3 ) 00q{ ^fail ( CALL ) } 004 `
^removeperiods o 524288 0 B( $_modelx $_x ) ^nofail ( RULE $_x = ^substitute ( character $_modelx . "" ) ) ^if 00y( ^pos ( ismodelnumber $_x ) ) 012{ $_modelx = ^pos ( allupper $_modelx ) $_x = ^pos ( allupper $_x ) } 004 ^if 00o( $_x ? ~allmodels ) 00r{ ^return ( $_x ) } 004 ^return ( $_modelx ) `
^setversion o 524288 0 C( $_variable ^version ) ^if 00c( ! ^1 ) 00n{ ^return ( ) } 004 $_variable = ^pos ( lowercase $_variable ) ^if 00q( ! $data.$_variable ) 00!{ $data.$_variable = ^jsoncreate ( PERMANENT OBJECT ) } 004 ^if 00y( ! $data.$_variable.version ) 00F{ $data.$_variable.version = ^1 } 004 `
^pairstartupword o 524288 0 A( ) ^if 00K( PATTERN _ [ up on ] @_0- *~3 ~bootable ) 00B{ ^mark ( ~pairstartup _0 ) } 01c else 00F( PATTERN ~bootable *~3 _ [ up on ] ) 00B{ ^mark ( ~pairstartup _0 ) } 004 `
^addproblem o 524288 0 B( ^problem ) ^jsonarrayinsert ( "PERMANENT UNIQUE" $data.problems ^0 ) `
^hasproblem p 524288 0 B( ^problem ) ^notrace ( ^query ( direct_so $data.problems ? ^0 1 ) ) `
^findcategory o 524288 0 B( ^specialty $_index $_category ) $_index = ^find ( ~specialties ^0 ) $_category = ^nth ( ~categories $_index ) ^return ( $_category ) `
^getspecialtyarray o 524288 0 B( ^specialty $_category ) ^if 00g( ^0 == os ) 00n{ ^return ( ) } 00@ else 00w( ^0 == streaming_services ) 00n{ ^return ( ) } 004 $_category = ^findcategory ( ^0 ) ^if 00u( $_category == computer ) 00O{ ^return ( $data.computer_specialties ) } 013 else ( 1 ) 00~ { ^return ( $data.consumer_electronics_specialties ) } 004 `
^deletespecialty o 524288 0 C( $_specialty $_limit $_specialtyarray ) $_specialty = ^pos ( lowercase $_specialty ) ^if 00Y( $_limit and ^findcategory ( $_specialty ) != $_limit ) 00s{ ^return ( null ) } 004 $_specialtyarray = ^getspecialtyarray ( $_specialty ) ^jsonarraydelete ( VALUE $_specialtyarray $_specialty ) ^if 00x( $_specialty == $specialty ) 00t{ $specialty = null } 004 `
^add2specialties o 524288 0 C( ^specialty ^startup $_specialty $_array ) ^if 00c( ! ^0 ) 00n{ ^return ( ) } 004 $_specialty = ^pos ( lowercase ^0 ) $_array = null ^if 00l( ^0 == desktop ) 01N{ ^if 00A( $data.desktop.brand == Apple ) 00t{ $_specialty = mac } 00M else ( 1 ) 00w { $_specialty = laptop } 004 } 08D else 00m( ^0 == ipcamera ) 00L{ $_specialty = home_security_systems } 07E else 00q( ^0 == analogcamera ) 00L{ $_specialty = home_security_systems } 06B else 00k( ^0 == tablet ) 03p{ ^if 00E( $data.tablet.os.model == ANDROID ) 01f{ $_array = $data.consumer_electronics_specialties $_specialty = android_devices } 01y else 00A( $data.tablet.os.model == iOS ) 00t{ $_specialty = mac } 00D else ( 1 ) 00n { ^return ( ) } 004 } 02~ else 00g( ^0 == os ) 00n{ ^return ( ) } 02i else 00w( ^0 == streaming_services ) 00n{ ^return ( ) } 01x else 00k( ^0 == laptop ) 014{ ^if 00z( $data.laptop.brand == Apple ) 00t{ $_specialty = mac } 004 } 004 $_array = ^getspecialtyarray ( $_specialty ) ^if 00h( ! $_array ) 00n{ ^return ( ) } 004 ^jsonarrayinsert ( "PERMANENT UNIQUE" $_array $_specialty ) ^if 00c( ! ^1 ) 00E{ ^setevidence ( $_specialty ) } 004 ^if 00%( ^0 == smartphones and $data.smartphones.os.model == ANDROID ) 010{ ^jsonarrayinsert ( "PERMANENT UNIQUE" $_array android_devices ) } 004 `
^brandinspecialty o 524288 0 B( ^brand $_brands $_brand ) $_brands = ^join ( ~ $specialty _brands ) $_brand = ^0 ^if 00T( ^query ( direct_svo $_brand member $_brands 1 ) ) 00y{ ^return ( $specialty ) } 00I else ( 1 ) 00s { ^return ( null ) } 004 `
^showitem o 524288 0 B( ^item $_result $_var $_var2 $_result1 ) @0 = ^burst ( ^0 " " ) ^loop ( -1 ) 07p { $_result = null _0 = ^first ( @0subject ) _1 = ^burst ( _0 / ) ^if 00c( ! _2 ) 01T{ $_var = _1 ^if 00z( ^extract ( $_var 0 1 ) == $ ) 00t{ $_result = ^$_var } 00I else ( 1 ) 00s { $_result = $_var } 004 } 03Y else ( 1 ) 03I { $_var = _1 $_result = ^$_var ^if 00g( $_result ) 02X{ $_var = _2 ^if 00A( ^extract ( $_var2 0 1 ) == $ ) 00u{ $_result1 = ^$_var } 00J else ( 1 ) 00t { $_result1 = $_var } 004 ^if 00h( $_result1 ) 00T{ $_result = ^join ( $_result " " $_result1 ) } 004 } 004 } 004 ^if 00g( $_result ) 00w{ ^return ( $_result ) } 004 } ^return ( null ) `
^brandtable t 524288 0 H( ^specialty ^brandconcept ^modelconcept ^osconcept ^brand ^model ^os $_junk $_model $_generic $_tmp $_model2 $_modelconcept $_len $_version $_unit $_vermodel ) ^addproperty ( ^4 NOUN NOUN_PROPER_SINGULAR ) ^if 00A( ^6 != * and ^3 != NO_VERSION ) 00V{ ^addproperty ( ^6 NOUN NOUN_PROPER_SINGULAR ) } 004 $_junk = ^createfact ( ^4 member ^1 ORIGINAL_ONLY ) $_junk = ^createfact ( ^4 member ~alltechbrands ORIGINAL_ONLY ) $_junk = ^createfact ( ^4 kindof ^0 ORIGINAL_ONLY ) ^if 00r( ^2 != * and ^5 != * ) 0rq{ $_model = ^5 $_generic = ^extract ( $_model 0 1 ) ^if 00m( $_generic == < ) 00N{ $_model = ^extract ( $_model 1 1000 ) } 004 _0 = ^burst ( $_model ) $_tmp = ^createfact ( _0 member ~protectedwords ORIGINAL_ONLY ) ^if 00a( _1 ) 010{ $_tmp = ^createfact ( _1 member ~protectedwords ORIGINAL_ONLY ) } 004 $_model2 = ^join ( _0 _ _1 ) $_modelconcept = ^2 ^if 00G( $_generic == < or ^3 == NO_VERSION ) 00b{ } 04o else 00x( $_model2 ? $_modelconcept ) 01${ $_len = ^length ( $_model2 ) + 1 $_version = null ^nofail ( RULE $_version = ^extract ( $_model $_len 1000 ) ) $_model = $_model2 } 01* else ( 1 ) 01S { $_len = ^length ( _0 ) + 1 $_version = null ^nofail ( RULE $_version = ^extract ( $_model $_len 1000 ) ) $_model = _0 } 004 ^if 00+( ! ^pos ( isinteger $_model ) and ! ^pos ( ismodelnumber $_model ) ) 00~{ ^addproperty ( $_model NOUN NOUN_PROPER_SINGULAR ) } 004 ^addproperty ( $_model 2305843009213693952 ) $_junk = ^join ( ^4 _ $_model ) $_junk = ^createfact ( $_junk kindof ^0 ORIGINAL_ONLY ) // this model/brand is this product $_junk = ^createfact ( $_model member ^2 ORIGINAL_ONLY ) $_junk = ^createfact ( $_model example ^4 ORIGINAL_ONLY ) $_junk = ^createfact ( $_model member ~allmodels ORIGINAL_ONLY ) ^if 00f( ^3 != * ) 01f{ $_unit = ^join ( ^4 _ $_model ) ^createfact ( $_unit use_os ^6 ORIGINAL_ONLY ) } 004 ^if 00t( $_version and $_model ) 01B{ $_vermodel = ^join ( $_model _ $_version ) $_tmp = ^createfact ( $_vermodel brand ^4 ORIGINAL_ONLY ) } 004 ^if 00S( $_version and ^pos ( ismodelnumber $_version ) ) 01*{ $_junk = ^createfact ( $_version version $_model ORIGINAL_ONLY ) $_junk = ^createfact ( $_version member ~allversions ORIGINAL_ONLY ) } 04? else 00O( $_version and ^pos ( isinteger $_version ) ) 01*{ $_junk = ^createfact ( $_version version $_model ORIGINAL_ONLY ) $_junk = ^createfact ( $_version member ~allversions ORIGINAL_ONLY ) } 02l else 00h( $_version ) 01*{ $_junk = ^createfact ( $_version version $_model ORIGINAL_ONLY ) $_junk = ^createfact ( $_version member ~allversions ORIGINAL_ONLY ) } 004 } 004 ^if 00f( ^3 != * ) 00S{ ^createfact ( ^6 member ^3 ORIGINAL_ONLY ) } 004 `
^settheme o 524288 0 B( ^theme $_theme $_specialty ) $_theme = ^0 ^if 015( $_theme == SMARTPHONES-BAD_PASSWORD and $data.smartphones.brand == Apple ) 00C{ $_theme = MAC-BAD_PASSWORD } 004 ^jsonarrayinsert ( "PERMANENT UNIQUE" $data.themes $_theme ) ^if 00l( ! $data.theme ) 00x{ $data.theme = $_theme } 004 _0 = ^burst ( $_theme - ) $_specialty = ^pos ( lowercase _0 ) $data.holder.$_specialty = 1 `
^setdata o 524288 0 A( ) ^if 00d( $data ) 00p{ ^end ( CALL ) } 004 $holder = ^jsoncreate ( PERMANENT object ) $symptoms = ^jsoncreate ( PERMANENT array ) $holder.x = $symptoms $data = ^jsoncreate ( PERMANENT object ) $holder.y = $data $data.nthemes = 0 $data.nspecials = 0 $data.nproblems = 0 $data.computer_specialties = ^jsoncreate ( PERMANENT array ) $data.consumer_electronics_specialties = ^jsoncreate ( PERMANENT array ) $data.problems = ^jsoncreate ( PERMANENT array ) $data.themes = ^jsoncreate ( PERMANENT array ) `
^killwantexpert o 524288 0 A( ) @0 = ^query ( direct_vo ? member '~wantexpert ) ^delete ( @0 ) @0 = ^query ( direct_v ? xrefcat ? ) ^delete ( @0 ) `
^console_log o 524288 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 524288 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 524288 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 524288 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 524288 0 B( ^name ) ^if 00J( ^query ( direct_sv ^0 canonical ? 1 ) ) 00w{ ^return ( @0object ) } 00G else ( 1 ) 00q { ^return ( ^0 ) } 004 `
^getbrand o 524288 0 C( ^model ^version $_vermodel $_tmp ) ^if 00a( ^1 ) 01={ $_vermodel = ^join ( ^0 _ ^1 ) $_tmp = ^query ( direct_sv $_vermodel brand ? 1 ? @4object ) ^if 00d( $_tmp ) 00t{ ^return ( $_tmp ) } 004 } 004 @1 = ^query ( direct_sv ^0 example ? ) ^if 00q( ^length ( @1 ) > 1 ) 00s{ ^return ( null ) } 004 ^if 00r( ^length ( @1 ) == 0 ) 00s{ ^return ( NULL ) } 004 ^return ( @1object ) `
^get_model_if_brand_matches_or_null o 524288 0 C( ^model ^brand $_brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $_brand = ^getbrand ( ^0 null ) ^if 00h( ! $_brand ) 00s{ ^return ( null ) } 004 ^if 00l( $_brand == ^1 ) 00J{ ^return ( ^get_canonical ( ^0 ) ) } 004 ^return ( null ) `
^get_os_if_brand_matches_or_default o 524288 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 ^if 00K( ! ^query ( direct_sv ^0 instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00m( @0object != ^1 ) 00q{ ^return ( ^2 ) } 004 ^if 00G( ^query ( direct_sv ^0 use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 524288 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 ^if 00H( ^query ( direct_sv ^0 example ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 524288 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 ^if 00G( ^query ( direct_sv ^0 use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 524288 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00? else ( 1 ) 00T { $_specialtyfactname = ^pos ( lowercase ^1 ) } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^getshortexpertsingular o 524288 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00? else ( 1 ) 00T { $_specialtyfactname = ^pos ( lowercase ^1 ) } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^getshortexpertplural o 524288 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00? else ( 1 ) 00T { $_specialtyfactname = ^pos ( lowercase ^1 ) } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { Experts } 004 `
^getexpertplural o 524288 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00? else ( 1 ) 00T { $_specialtyfactname = ^pos ( lowercase ^1 ) } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { Experts } 004 `
^nextgambit o 524288 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 524288 0 B( ^symptom ) $symptom = ^0 ^createfact ( $symptom symptomlist x ) `
^setsymptominput o 524288 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^hassymptom d 524288 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^oob o 524288 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 524288 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 524288 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 524288 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 524288 0 A( $_tmp ) ^delete ( $holder ) $holder = null $data = null $symptoms = null ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $questionprice = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 524288 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $questionprice = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^askquestion o 524288 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 524288 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 524288 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 524288 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^petreference o 524288 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 524288 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 524288 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 524288 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 524288 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 524288 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^setcategory o 524288 0 C( ^category ^specialty ) $category = ^0 $specialty = ^1 $expert = ^getexpert ( $category $specialty ) $shortexpertsingular = ^getshortexpertsingular ( $category $specialty ) $shortexpertplural = ^getshortexpertplural ( $category $specialty ) $expertplural = ^getexpertplural ( $category $specialty ) $currentexperttopic = ^"~$category\_expert" $$assistanttitleoob = ^"assistanttitle=$expert's Assistant" $$assistanttitleoob = ^substitute ( character $$assistanttitleoob _ " " ) $$assistantnameoob = ^"assistantname=Pearl Wilson" `
^glean o 524288 0 A( ) ^respond_safe ( "^~$expert\_glean" $source ) ^respond_safe ( "^~$expert\_glean_symptoms" $source ) ^if 00+( ^substitute ( character $currentexperttopic _expert _glean FAIL ) ) 02I{ ^respond_safe ( "^^substitute(character $currentExpertTopic _expert _glean)" $source ) ^respond_safe ( "^^substitute(character $currentExpertTopic _expert _glean_symptoms)" $source ) } 004 `
^nouploademail p 524288 0 A( ) [ ^hasproblem ( NoUploadEmail ) << [ unable try ~negation ~hardwareproblem ] [ attach upload send deliver forward ] >> ] `
^noviewemail p 524288 0 A( ) [ ^hasproblem ( NoViewEmail ) ( << [ unable try ~negation ~hardwareproblem ] [ view see receive display show open ] >> << [ $data.email ~email_keywords =c$specialty=email mail email messages outbox ] >> ~datum_stuff ) ] `
^cantsendemail p 524288 0 A( ) ( !( [ can will still ] send ) [ ^hasproblem ( CantSendEmail ) ( [ << not send error >> ( [ stuck waiting still remain pending ] *~2 outbox ) ( [ stopped no_longer not ] send ) ] << [ $data.email ~email_keywords =c$specialty=email mail email message outbox ] >> ) ] ) `
^noreceivemail p 524288 0 A( ) ( !( [ can will still ] receive ) [ ^hasproblem ( NoReceiveMail ) ( [ << ~negation [ receive see get retrieve ] >> ( [ stopped no_longer ] receive ) ] << [ $data.email ~email_keywords =c$specialty=email mail email messages outbox ] >> ) ] ) `
^lostemail p 524288 0 A( ) ( !( [ is_there how ] * [ 'remove 'delete erase ] ) !( [ want would_like need ] * [ 'remove 'delete erase ] ) !( not * [ 'remove 'delete erase ] ) [ ^hasproblem ( LostEmail ) [ << [ retrieve recover rescue restore look_for find ] [ trash delete erase ] >> ( get *~2 back * [ delete trash erase ] ) [ deleted trashed erased ] ( [ lose look find ] *~2 [ email mail message ] ) << [ accident accidentally unintentionally mistakenly mistake ] [ erase delete remove ] >> ] ] << [ $data.email ~email_keywords =c$specialty=email mail email messages outbox ] >> ) `
^badoverwrite p 524288 0 A( ) [ ^hasproblem ( BadOverwrite ) << [ revert recover retrieve rescue save get undo ] [ $data.software.brand document doc spreadsheet sheet version file paper ] >> << [ save_over saved overwrite write_over ] [ document doc spreadsheet sheet file version paper accidentally unintentionally mistakenly ] >> ] `
^badharddrive p 524288 0 A( ) [ ^hasproblem ( BadHarddrive ) ( [ << [ drive disk harddrive ] [ ~negation stop how ] [ register use work function detect read recognize connect access open appear spin come_on turn_on show_up ] >> << [ drive disk harddrive ] [ ~hardwareproblem spins read slow ] >> ] ~harddrive_stuff ) ] `
^printerbadcontrast p 524288 0 A( ) [ ^hasproblem ( PrinterBadContrast ) [ << [ blank empty ] [ page sheet streak line ] >> ( !( << how black only >> ) << [ only just predominantly mainly nothing barely slightly ] [ black blue cyan magenta pink red yellow ] >> ) ( print *~2 [ line blank streak streaky ] ) ( print quality *~4 be_off ) ] ] `
^badcontrast p 524288 0 A( ) [ ^hasproblem ( BadContrast ) << [ need_to how_to how_do adjust alter change modify ] ~screen >> ( [ ~screen contrast ] *~3 [ too so very ] ) << [ nothing anything blank empty streak streaky partial_letter ] [ print ~screen ] >> << [ too_much too_little invisible not_visible only just weak poor pale bad predominantly missing blur blurry inconsistent omitted mainly ~negation streak streaky faded washed_out nothing barely slightly ] [ contrast black blue white cyan magenta pink red yellow color ] >> ] `
^badpassword p 524288 0 A( ) !lock_up !( ~screen *~2 be *~2 locked ) !error_code !not_locked [ ^hasproblem ( BadPassword ) ( << ~needlostforgot ~password >> ) ( << [ not_sure uncertain doubtful doubt uncertainty ] ~password >> ) [ lock_out access lock unlock get_in activate ] ( << ~hardwareproblem ~login >> ) ( << ~assistance ~login >> ) lock_out device_locked ( << ~loginrefuse [ ~password ~login ] >> ) ( not let me past ) ( not [ get sign ] [ in on into onto ] ) << ~negation ~login >> ( not get_back [ to into on in ] ) ( how *~5 [ change alter replace ] *~5 [ ~password ~login ] ) ] `
^badmouse p 524288 0 A( ) [ ^hasproblem ( BadMouse ) ( [ << [ trackpad mouse trackball ] [ not unable stop how ] [ work function move connect ] >> ( !down [ trackpad mouse trackball ] *~5 ~hardwareproblem ) ( !down ~hardwareproblem *~5 [ trackpad mouse trackball ] ) ( [ trackpad mouse trackball ] *~2 broken ) ( broken *~2 [ trackpad mouse trackball ] ) ] ) ] `
^noprint p 524288 0 A( ) [ ^hasproblem ( NoPrint ) << ~negation [ connect able work function print use ] [ print printer $data.printers ] >> << [ ~hardwareproblem ~assistance ] [ print printer $data.printers ] >> ] `
^nopower p 524288 0 A( ) !come_on_screen !dead_pixel [ ^hasproblem ( NoPower ) ( [ ~hardwareproblem ~negation ] *~3 ~powerup ) ( [ ~hardwareproblem ~negation ] *~3 power ) died dead ( lost *~1 power ) power_off power_down ] `
^errorcode p 524288 0 A( ) ( !no_error [ ^hasproblem ( ErrorCode ) ( error { : \# } [ message code state light ~number ~model_number ] ) ( [ message code error ] { be : \# } [ ~number ~modelnumber ] ) ( [ ~number ~model_number ] error ) ( [ say show have ] { a } error ) ( error say ) ] ) `
^nointernettv p 524288 0 A( ) ( ![ remote volume sound audio ] [ ^hasproblem ( NoInternetTV ) << [ no not issue problem trouble ] [ connect get download load setup set run show work ] [ $data.streaming_services ~wifi $data.networking ] >> ( get *~4 [ $data.streaming_services internet ] ) ( [ no not issue problem trouble ] *~3 [ $data.streaming_services ~wifi $data.networking ] ) ] ) `
^notworkprinter p 524288 0 A( ) [ << [ printer $data.printer ] [ not unable how try help ] [ connect able work function print ] >> << [ print printer $data.printer ] [ problem issue difficulty malfunction help assist assistance ] >> ( print *~2 [ nothing anything ] ) ] `
^nointernet p 524288 0 A( ) [ ^hasproblem ( NoInternet ) << [ ~wifi $data.routerl ] [ not unable how difficulty ] [ work function connect get enable on ] >> << [ ~wifi $data.router ] no connection >> << [ ~wifi $data.router ] [ problem issue broken dead spotty ] >> ( no ~wifi ) offline ( get *~4 [ $data.streaming_services ~wifi ] ) ] `
^badhandset p 524288 0 A( ) [ ^hasproblem ( BadHandset ) ( [ $data.phone_systems handset landline ] [ registration unregistered register connect pair ~hardwareproblem ] ) [ out_of_range dial_tone ] ] `
^badfocus p 524288 0 A( ) [ ^hasproblem ( BadFocus ) << [ ~negation ~hardwareproblem try fail ] [ focus autofocus ] >> [ blurry out_of_focus unfocused ] ] `
^nosync p 524288 0 A( ) [ ^hasproblem ( NoSync ) << [ ~negation ~hardwareproblem ] [ upload connect link pair recognize detect sync sink ] >> ( [ want try ] *~3 [ sync sink ] ) ] `
^noconnect p 524288 0 A( ) [ ^hasproblem ( NoConnect ) ( ~negation *~3 [ connect connection ] *~2 [ with to ] ) ] `
^badlens p 524288 0 A( ) [ ^hasproblem ( BadLens ) << [ retract extend lens come_out ] [ bad stuck jam error ~hardwareproblem ~negation ] >> ] `
^badcharge p 524288 0 A( ) [ ^hasproblem ( BadCharge ) << [ ~negation ~hardwareproblem ] [ charge recharge ] >> ] `
^noplayertv p 524288 0 A( ) [ ^hasproblem ( NoPlayerTV ) [ ( [ unable not trouble issue problem ] * [ connect link hookup hook_up ] * [ TV $data.tv ] ) << [ unable not problem issue trouble ] [ see appear view connect link hookup stream hook_up ] [ screen $data.recorders_and_players stick digital_media_player DLNA media hub server LAN HDD drive ] >> ] ] `
^frozen p 524288 0 A( ) !not_locked [ ^hasproblem ( Frozen ) [ unjam unfreeze unstick stuck freeze frozen jammed ] ( not *~2 [ react respond release ] ) ( spinning *~3 [ wheel ball beachball circle symbol rainbow ] ) ( [ wheel ball beachball circle symbol rainbow ] *~3 spinning ) pinwheel RWOD ] `
^badcrash p 524288 0 A( ) [ ^hasproblem ( BadCrash ) << [ crash break restarted ] >> ] `
^baderase p 524288 0 A( ) !( how *~4 [ erase delete ] ) [ ^hasproblem ( BadErase ) [ erase trash throw discard ] << delete [ file attachment document text sheet version file paper ~filetype message ] >> << ~assistance [ recover retrieve restore rescue get_back ] >> ] `
^needupgrade p 524288 0 A( ) [ ^hasproblem ( NeedUpgrade ) << [ 'update 'upgrade ] [ how need want try where way download not ] >> << [ 'update 'upgrade new newer newest current recent latest next last ] $data.software.brand >> << [ how need where way look ] [ new newer newest current recent latest next last ] version >> << [ need want desire ~assistance ] $data.software.brand version >> ] `
^needuninstall p 524288 0 A( ) [ ^hasproblem ( NeedUninstall ) << ~deinstall [ can how need where way want try like ] >> << delete [ can how need where way want try like ] [ =c$specialty=software $data.software.brand ] >> ] `
^needprogramminghelp p 524288 0 A( ) [ ^hasproblem ( NeedProgrammingHelp ) ( ~writecode *~3 ~programming_keywords ) ( $data.programming.language *~4 ~programming_keywords *~2 [ which that to in_order ] ) << [ homework assignment programming coding coursework ] [ do help how give ] >> << [ help how problem issue difficulty ] [ $data.programming.language code pseudocode ] >> ] `
^badblog p 524288 0 A( ) [ ^hasproblem ( BadBlog ) [ ( [ website site vlog blog $data.hostsite content post ] *~3 [ lose crashed delete disappear dissapear disapear dissappear down not_load ] ) ( [ lose crashed delete disappear dissapear disapear dissappear down not_load ] *~3 [ website site vlog blog $data.hostsite content post ] ) << [ recover retrieve revert rescue ] [ website site vlog blog $data.hostsite content post ] >> << post [ no not unable ] [ view review see ] >> ] ] `
^cantopen p 524288 0 A( ) [ ^hasproblem ( CantOpen ) ( << [ ~hardwareproblem ~negation ] [ open access pull view ] >> ) ( << ~negation [ run launch execute access open load get_in ] >> ) ] `
^badscreen p 524288 0 A( ) !a_picture !take_picture !photograph !photo [ ^hasproblem ( BadScreen ) stuck_pixel ( pixel *~2 stuck ) ( ghost image ) << [ pixel pixelate digitize ] [ ~screen image picture ] >> ( << ~screen ~black >> ) ( [ no nothing ] *~4 on *~4 ~screen ) << ~negation [ display show see ] ~screen >> ( << ~screen [ ~black crack ] >> ) blacked_out ( [ no nothing ] *~4 on *~4 ~screen ) ( << ~negation [ display show see ] ~screen >> ) ( [ be went ] *~4 ~frozenscreen ) ( << [ picture image ~screen ] [ gone not_visible out ~black blacked whited_out striped blue snowy gray ] >> ) ( << ~screen ~negation light >> ) ( << ~screen [ bad ~hardwareproblem faded disappear go_away ~blackscreen line ] >> ) ( [ be went ] *~3 ~blackscreen ) ] `
^badvideo p 524288 0 A( ) [ ^hasproblem ( BadVideo ) ( [ no not ] *~2 [ video output record picture ] ) ( camera *~2 stop [ working functioning recording ] ) ( video loss ) ] `
^missingcontroller p 524288 0 A( ) [ ^hasproblem ( MissingController ) << ~tv_remote [ ~negation lose missing misplace mislay mislaid gone ate ~hardwareproblem seek want look ] >> ] `
^badsound p 524288 0 A( ) !how_do !how_to !( sound { be } [ fine work ] ) !have_sound !just_sound !get_sound [ ^hasproblem ( BadSound ) ( [ hear sound audio ] *~3 [ stop_working shut_off go_out flicker muffle missing ] ) << [ hear sound audio ] ~hardwareproblem >> ( [ ~negation ] *~2 [ sound audio hear here volume ] ) ( sound *~3 tinny ) ( sound *~1 [ go fade ] *~4 [ in out ] ) [ volume mute quiet loud ] ( << [ hard ~negation buzz crackle tinny ] [ buzz buzz crackle noise ] >> ) ( [ hard ~hardwareproblem ~negation buzz crackle tinny ] *~3 [ hear audio sound buzz buzz crackle noise ] ) ( be *~3 [ loud quiet mute low ] ) ( [ volume audio sound ] *~3 be ) ( low *~2 [ sound audio ] ) ( speaker *~2 [ not stop ] *~2 [ function work ] ) ] `
^badsim p 524288 0 A( ) [ ^hasproblem ( BadSIM ) ( << SIM ~negation [ recognize register provisioned valid found detect locate see ] >> ) ( << SIM [ invalid block failure lock ] >> ) ( ~negation *~2 SIM ) ] `
^timecheck p 524288 0 A( ) [ ( =9%length<8 [ ( << what be 'time >> ) be_the_time ( [ tell know aware ] * 'time ) ] ) ( !~qwords you < * [ know have aware ] !good * { what the } [ time hour ] !to { be } > ) ( !~qwords 'you *~2 the time ) ( !~qwords the time to I ) ] `
^compute_day o 524288 0 C( ^day ^amount ) $$amount = ^1 ^query ( direct_vo ? dayvalue ^0 1 ) _8 = ^compute ( @0subject add ^1 ) ^loop ( -1 ) 028 { ^if 00e( _8 > 7 ) 00C{ _8 = ^compute ( _8 sub 7 ) } 01n else 00e( _8 > 0 ) 00p{ ^end ( RULE ) } 00S else ( 1 ) 00C { _8 = ^compute ( _8 add 7 ) } 004 } ^query ( direct_sv _8 dayvalue ? 1 ) $$day = @0object `
^compute_month o 524288 0 C( ^month ^amount ) $$amount = ^1 ^query ( direct_vo ? value ^0 1 ) _8 = ^compute ( @0subject add ^1 ) ^loop ( -1 ) 02b { ^if 00f( _8 > 12 ) 00D{ _8 = ^compute ( _8 sub 12 ) } 01o else 00e( _8 > 0 ) 00p{ ^end ( RULE ) } 00T else ( 1 ) 00D { _8 = ^compute ( _8 add 12 ) } 004 } ^query ( direct_sv _8 value ? 1 ) $$month = @0object `
^ordering t 524288 0 D( ^kind ^item ^value ) ^createfact ( ^2 ^0 ^1 ) `
^netdevicemodels p 524288 0 A( ) [ $data.tv.model $data.printers.model $data.laptop.model $data.desktop.model $data.tablet.model $data.smartphones.model $data.gamesystem.model ] `
^netdevicebrands p 524288 0 A( ) [ $data.tv.brand $data.printers.brand $data.laptop.brand $data.desktop.brand $data.tablet.brand $data.smartphones.brand $data.gamesystem.brand ] `
^orderthemes o 524288 0 A( $_theme $_val ) ^if 00z( ^length ( $data.theme ) < 2 ) 00n{ ^return ( ) } 004 @1 = null @0 = ^query ( direct_s $data.themes ? ? ) ^loop ( -1 ) 022 { $_theme = ^first ( @0object ) $_val = 0 ^nofail ( RULE $_val = ^find ( ~themes $_theme ) ) @1 += ^createfact ( $_val x $_theme FACT_TRANSIENT ) } ^sort ( @1subject ) $data.theme = ^first ( @1object ) `
^safeword p 524288 0 A( ) [ =4_0=='_0 =4_0==unknown-word =4_0?~number ^pos ( isModelNumber '_0 ) ^substitute ( character '_0 _ x fail ) ] `
^legalbrandit o 524288 0 A( $_lcbrand ) $_lcbrand = ^pos ( lowercase '_10 ) ^if 00q( '_10 ? ~safebrands ) 00b{ } 07L else 00~( $specialty and ^branddoesspecialty ( '_10 $specialty ) ) 00b{ } 06I else 01p( PATTERN @_10 { model } { [ no number \# ] } _ ~allmodels ! =4_0?~number ^length ( '_10 ) > 3 ) 00b{ } 053 else 00K( ^properties ( $_lcbrand ) & 1073741824 ) 00q{ ^fail ( RULE ) } 041 else 00C( ^properties ( $_lcbrand ) & 32 ) 00q{ ^fail ( RULE ) } 037 else 00J( ^properties ( $_lcbrand ) & 134217728 ) 00q{ ^fail ( RULE ) } 026 else 00J( ^properties ( $_lcbrand ) & 536870912 ) 00q{ ^fail ( RULE ) } 015 else 00J( ^properties ( $_lcbrand ) & 268435456 ) 00q{ ^fail ( RULE ) } 004 `
^selectspecialty o 524288 0 C( $_brand $_model $_junk $_tmp ) $_junk = ^join ( $_brand _ $_model ) @0 = ^query ( direct_sv $_junk kindof ? ) ^if 00r( ^length ( @0 ) == 1 ) 00w{ ^return ( @0object ) } 004 ^loop ( -1 ) 05n { $_tmp = ^first ( @0object ) ^if 00n( $_tmp == laptop ) 01h{ ^if 00L( PATTERN [ =c$specialty==laptop laptop ] ) 00u{ ^return ( laptop ) } 004 } 03m else 00o( $_tmp == desktop ) 01a{ ^if 00D( PATTERN [ desktop workstation ] ) 00v{ ^return ( desktop ) } 004 } 01W else 00n( $_tmp == tablet ) 01q{ ^if 00U( PATTERN [ =c$specialty==android_devices tablet ] ) 00u{ ^return ( tablet ) } 004 } 004 } ^if 00r( $_model == ThinkPad ) 00u{ ^return ( laptop ) } 004 ^return ( NULL ) `
^applecomputernotmobile p 524288 0 A( ) ! =k$data.tablet.brand=Apple ! =p$data.smartphones.brand=Apple [ =l$data.desktop.brand==Apple =k$data.laptop.brand==Apple ] `
^applemobilenotcomputer p 524288 0 A( ) [ =k$data.tablet.brand=Apple =p$data.smartphones.brand==Apple ] ! =l$data.desktop.brand=Apple ! =k$data.laptop.brand=Apple `
^notapplemobileorcomputer p 524288 0 A( ) ! =k$data.tablet.brand=Apple ! =p$data.smartphones.brand=Apple ! =l$data.desktop.brand=Apple ! =k$data.laptop.brand=Apple `
^describe p 524288 0 A( ) [ describe tell_me want_to_hear what_be who_be wonder_about curious_about the_deal_behind the_deal_around ] * `
^mergeml o 524288 0 A( $_mlcategory $_choice $_pearlspecialty $_mlspecialty $_tmp $_lowconfidence $_n $_index $_object $_category $_confidence $_index1 $_created $_specialty $_specialtyconfidence ) $_mlcategory = $data.mlprediction[0].category ^if 00J( $data.mlprediction[0].confidence > .8 ) 049{ @5 = ^query ( direct_vo ? category maybe ) ^loop ( -1 ) 03h { $_choice = ^first ( @5subject ) _0 = ^burst ( $_choice - ) ^if 00x( _0 == $_mlcategory and _1 ) 00x{ $_pearlspecialty = _1 } 01y else 00q( _0 == $_mlcategory ) 00={ $_mlspecialty = $data.mlprediction[0].specialties[0].specialty } 004 } } 004 ^if 00o( $_pearlspecialty ) 02s{ @5 = ^query ( direct_vo ? category maybe ) ^delete ( @5 ) $_tmp = ^join ( $_mlcategory - $_pearlspecialty ) $_tmp = ^createfact ( $_tmp category maybe ) ^end ( CALL ) } 01o else 00l( $_mlspecialty ) 00&{ @5 = ^query ( direct_vo ? category maybe ) ^delete ( @5 ) } 004 $_lowconfidence = .4 $_n = ^length ( $data.mlprediction ) $_index = 0 ^loop ( $_n ) 08k { $_object = $data.mlprediction[$_index] $_category = ^pos ( lowercase $_object.category ) $_confidence = $_object.confidence $_index += 1 $_n = ^length ( $_object.specialties ) $_index1 = 0 $_created = null ^loop ( $_n ) 048 { $_specialty = $_object.specialties[$_index1].specialty $_specialtyconfidence = $_object.specialties[$_index1].confidence ^if 00L( $_specialtyconfidence < $_lowconfidence ) 00q{ ^next ( LOOP ) } 004 $_tmp = ^join ( $_category - $_specialty ) $_tmp = ^createfact ( $_tmp category maybe ) $_created = 1 } ^if 00j( ! $_created ) 00Z{ $_tmp = ^createfact ( $_category category maybe ) } 004 } `
^hascat o 524288 0 B( ^cat $_catref ) @5 = ^query ( direct_vo ? category maybe ) ^loop ( -1 ) 01B { $_catref = ^first ( @5subject ) _0 = ^burst ( $_catref - ) ^if 00g( _0 == ^0 ) 00p{ ^return ( 1 ) } 004 } ^fail ( CALL ) `
^setwant o 524288 0 C( $_expert $_catspec $_tmp $_fact ) $_tmp = ^pos ( lowercase $_expert ) $_fact = ^createfact ( $_tmp member ~wantexpert ) $_fact = ^createfact ( $_tmp xrefcat $_catspec ) _0 = ^burst ( $_tmp ) $_fact = ^createfact ( _0 member ~wantexpert ) $_fact = ^createfact ( _0 xrefcat $_catspec ) ^if 00a( _1 ) 02-{ $_fact = ^createfact ( _1 member ~wantexpert ) $_fact = ^createfact ( _1 xrefcat $_catspec ) ^if 00a( _2 ) 01t{ $_fact = ^createfact ( _2 member ~wantexpert ) $_fact = ^createfact ( _2 xrefcat $_catspec ) } 004 } 004 `
^verifyemail o 524288 0 A( $_mail ) $_mail = ^original ( _0 ) ^if 00N( ^substitute ( character $_mail @ x FAIL ) ) 00q{ ^fail ( call ) } 004 `
^setevidence o 33554432 0 B( $_specialty ) $holder.$_specialty = 1 `
^add2specialties o 33554432 0 C( ^specialty ^startup $_specialty $_array ) ^if 00c( ! ^0 ) 00n{ ^return ( ) } 004 $_specialty = ^pos ( lowercase ^0 ) $_array = null $_array = $data.legalspecialties ^if 00h( ! $_array ) 00n{ ^return ( ) } 004 ^jsonarrayinsert ( "PERMANENT UNIQUE" $_array $_specialty ) ^if 00c( ! ^1 ) 00E{ ^setevidence ( $_specialty ) } 004 `
^settheme o 33554432 0 B( ^theme $_theme $_specialty ) $_theme = ^0 ^jsonarrayinsert ( "PERMANENT UNIQUE" $data.themes $_theme ) ^if 00l( ! $data.theme ) 00x{ $data.theme = $_theme } 004 _0 = ^burst ( $_theme - ) $_specialty = ^pos ( lowercase _0 ) $data.holder.$_specialty = 1 `
^setdata o 33554432 0 A( ) ^if 00d( $data ) 00p{ ^end ( CALL ) } 004 $holder = ^jsoncreate ( PERMANENT object ) $symptoms = ^jsoncreate ( PERMANENT array ) $holder.x = $symptoms $data = ^jsoncreate ( PERMANENT object ) $holder.y = $data $data.legal_specialties = ^jsoncreate ( PERMANENT array ) `
^console_log o 33554432 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 33554432 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 33554432 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 33554432 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 ^if 012( $dualgambit and $category == legal and $smartlegal and ! $firstgambit ) 01a{ $firstgambit = 1 ^nofail ( TOPIC ^gambit_safe ( ~legal_expert $source ) ) } 004 `
^get_canonical o 33554432 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 33554432 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 33554432 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 33554432 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 33554432 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 33554432 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^getshortexpertsingular o 33554432 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^getshortexpertplural o 33554432 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { Experts } 004 `
^getexpertplural o 33554432 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { Experts } 004 `
^nextgambit o 33554432 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 33554432 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 33554432 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 33554432 0 B( ^what ) ^if 00N( ^substitute ( character $$oob ^0 x fail ) ) 00p{ ^end ( CALL ) } 004 ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 33554432 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 33554432 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 33554432 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 33554432 0 A( $_tmp ) ^delete ( $holder ) $holder = null $data = null $symptoms = null ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 33554432 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 33554432 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 33554432 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 33554432 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 33554432 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 33554432 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 33554432 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 33554432 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 33554432 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 33554432 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 33554432 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 33554432 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 33554432 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 33554432 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^setcategory o 33554432 0 C( ^category ^specialty ) $category = ^0 $specialty = ^1 $expert = ^getexpert ( $category $specialty ) $shortexpertsingular = ^getshortexpertsingular ( $category $specialty ) $shortexpertplural = ^getshortexpertplural ( $category $specialty ) $expertplural = ^getexpertplural ( $category $specialty ) $currentexperttopic = ^"~$category\_expert" $$assistanttitleoob = ^"assistanttitle=$expert's Assistant" $$assistanttitleoob = ^substitute ( character $$assistanttitleoob _ " " ) $$assistantnameoob = ^"assistantname=Pearl Wilson" `
^verbplurality o 33554432 0 D( $_word ^verbsingular ^verbplural $_tmp ) ^if 00O( ^substitute ( character $_word " and " x ) ) 00q{ ^return ( ^2 ) } 004 ^if 00k( $data.plural ) 00q{ ^return ( ^2 ) } 004 $_tmp = ^pos ( NOUN $_word PLURAL ) ^if 00n( $_tmp == $_word ) 00q{ ^return ( ^2 ) } 00G else ( 1 ) 00q { ^return ( ^1 ) } 004 `
^fixstate o 33554432 0 A( $_tmpstate $_tmp $_state $_adj ) $_tmpstate = ^substitute ( character $data.state " " _ ) ^nofail ( RULE $_tmp = ^find ( ~state $_tmpstate ) ) ^if 00f( ! $_tmp ) 02^{ $_state = $_tmpstate ^if 00P( ^substitute ( character $_state DC x fail ) ) 00o{ $_state = DC } 004 $_adj = ^query ( direct_vo ? adjective $_state 1 ? @0subject ) ^if 00d( $_adj ) 00r{ $_state = $_adj } 004 } 03A else ( 1 ) 03k { $_tmp = ^nth ( ~state_abbreviations $_tmp ) ^if 01y( $_tmp == OH or $_tmp == ME or $_tmp == IN or $_tmp == OR or $_tmp == GA or $_tmp == OK or $_tmp == HI ) 00w{ $_state = $_tmpstate } 00N else 00d( $_tmp ) 00r{ $_state = $_tmp } 004 } 004 ^return ( $_state ) `
^geodeterminer o 33554432 0 B( ^where $_state $_tmp ) $_state = ^query ( direct_sv ^0 adjective ? 1 ? @0object ) ^if 00h( ! $_state ) 00o{ $_state = ^0 } 004 $_tmp = ^query ( direct_vo ? $_state geodeterminer 1 ? @0subject ) ^if 00f( ! $_tmp ) 00l{ $_tmp = a } 004 ^return ( $_tmp ) `
^etopic o 33554432 0 A( ) ^if 00t( $data.employmenttopic ) 00x{ $data.employmenttopic } 004 `
^pickactor o 33554432 0 C( ^verbsingular ^verbplural ) ^if 00k( $data.family ) 00~{ ^verbplurality ( $data.family ^0 ^1 ) $data.family } 04* else 00Z( ^substitute ( character $data.person " and " x FAIL ) ) 00~{ ^verbplurality ( $data.person ^0 ^1 ) $data.person } 03h else 00k( $data.person ) 00~{ ^verbplurality ( $data.person ^0 ^1 ) $data.person } 025 else 00g( $data.he ) 00h{ ^0 he } 01G else 00h( $data.she ) 00i{ ^0 she } 012 else 00i( $data.they ) 00j{ ^1 they } 00z else ( 1 ) 00j { ^1 they } 004 `
^pickgender o 33554432 0 C( ^verbsingular ^verbplural ) ^if 00o( $data.party == 1 ) 00i{ ^1 you } 03L else 00u( $data.he and $data.she ) 00j{ ^1 they } 02^ else 00k( $data.plural ) 00j{ ^1 they } 02o else 00g( $data.he ) 00h{ ^0 he } 01Z else 00h( $data.she ) 00i{ ^0 she } 01l else 00C( $data.they or $data.party == 3 ) 00j{ ^1 they } 00y else ( 1 ) 00i { ^1 you } 004 `
^setstate o 33554432 0 B( $_state ) ^if 00Y( ^substitute ( character $_state $data.state x FAIL ) ) 00p{ ^end ( CALL ) } 01j else 00Y( ^substitute ( character $data.state $_state x FAIL ) ) 00p{ ^end ( CALL ) } 004 ^if 00D( $data.state or $data.ambigstate ) 01${ ^if 00q( ! $data.ambigstate ) 00G{ $data.ambigstate = $data.state } 004 $data.ambigstate = ^join ( $data.ambigstate "+" $_state ) } 00N else ( 1 ) 00x { $data.state = $_state } 004 `
^discardroles0 o 33554432 0 A( ) ^unmark ( ~allroles _0 ) ^unmark ( ~allrolesself _0 ) ^unmark ( ~mixed_noun _0 ) `
^discardverb0 o 33554432 0 A( ) ^unmark ( ~verblist _0 ) ^unmark ( ~verb _0 ) ^unmark ( ~verb2 _0 ) ^unmark ( ~mainverb _0 ) ^unmark ( ~mixed_noun _0 ) `
^rejected o 33554432 0 C( ^filename $_value $_file ) ^if 00o( ! $symptomoutput ) 00p{ ^end ( CALL ) } 004 ^if 00h( ! $_value ) 00p{ ^end ( CALL ) } 004 $_file = ^join ( TMP/ ^0 .txt ) ^log ( FILE $_file . $_value "^ \# " $$currentinput \n ) `
^within o 33554432 0 C( $_item $_set ) $_item = ^substitute ( character $_item " " _ ) ^if 00P( ^query ( direct_svo $_item member $_set 1 ) ) 00u{ ^return ( $_item ) } 00G else ( 1 ) 00q { ^fail ( CALL ) } 004 `
^makepossessive1 o 33554432 0 A( $_c ) ^if 00A( _1 == junior or _1 == senior ) 00q{ ^return ( _1 ) } 004 ^if 00C( ^pos ( noun _1 plural ) == '_1 ) 01Q{ $_c = ^extract ( '_1 -1 +1 ) ^if 00g( $_c == s ) 00r{ ^join ( _0 's ) } 00I else ( 1 ) 00s { ^join ( '_1 's ) } 004 } 01V else 00U( ^substitute ( character _1 unknown-word x FAIL ) ) 00s{ ^join ( '_1 's ) } 00H else ( 1 ) 00r { ^join ( _1 's ) } 004 `
^isallupper o 33554432 0 A( $_orig $_uc $_tmp $_tmp1 ) $_orig = ^original ( _0 ) $_uc = ^pos ( allupper '_0 ) $_tmp = ^createfact ( $_uc xx yy FACTRANSIENT ) $_tmp1 = ^createfact ( $_orig xx yy FACTRANSIENT ) ^if 00n( $_tmp1 != $_tmp ) 00q{ ^fail ( CALL ) } 004 `
^makepossessive0 o 33554432 0 A( $_c ) ^if 00A( _0 == junior or _0 == senior ) 00q{ ^return ( _0 ) } 004 ^if 00C( ^pos ( noun _0 plural ) == '_0 ) 03d{ $_c = ^extract ( '_0 -1 +1 ) ^if 00g( $_c == s ) 01!{ ^if 00U( ^substitute ( character _0 unknown-word x FAIL ) ) 00s{ ^join ( '_0 's ) } 00H else ( 1 ) 00r { ^join ( _0 's ) } 004 } 00I else ( 1 ) 00s { ^join ( '_0 's ) } 004 } 01V else 00U( ^substitute ( character _0 unknown-word x FAIL ) ) 00s{ ^join ( '_0 's ) } 00H else ( 1 ) 00r { ^join ( _0 's ) } 004 `
^setfamily o 33554432 0 C( $_determiner $_relation ) ^if 00N( $_determiner == my or $_determiner == our ) 00v{ $_determiner = your } 004 ^if 00Z( ! ^substitute ( character $data.family $_relation x ) ) 02${ ^if 00k( $_determiner ) 00P{ $_relation = ^"$_determiner $_relation" } 004 ^if 00k( $data.family ) 00V{ $data.family = ^"$data.family and $_relation" } 00R else ( 1 ) 00B { $data.family = $_relation } 004 } 004 `
^legalpetname p 33554432 0 A( ) ! =4_0?~number ! =4_0?~pronoun ! =4_0?~interjections ! =4_0?~conjunction ! =4_0?~determiner ! =4_0?~qwords ! =5'_0=Pearl ! =4_0?~pronoun_possessive ! =5'_0=world `
^listvar o 33554432 0 C( ^filename $_value $_file ) ^if 00h( ! $_value ) 00p{ ^end ( CALL ) } 004 $_file = ^join ( TMP/ ^0 .txt ) ^log ( FILE $_file . $_value "^ \# " %originalinput \n ) `
^console_log o 1048576 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 1048576 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 1048576 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 1048576 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 1048576 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 1048576 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 1048576 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 1048576 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 1048576 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 1048576 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^getshortexpertsingular o 1048576 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^getshortexpertplural o 1048576 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { Experts } 004 `
^getexpertplural o 1048576 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { Experts } 004 `
^nextgambit o 1048576 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 1048576 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 1048576 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 1048576 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 1048576 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 1048576 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 1048576 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 1048576 0 A( $_tmp ) ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 1048576 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 1048576 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 1048576 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 1048576 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 1048576 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 1048576 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 1048576 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 1048576 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 1048576 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 1048576 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 1048576 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 1048576 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 1048576 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 1048576 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^legalpetname p 1048576 0 A( ) ! =4_0?~number ! =4_0?~pronoun ! =4_0?~interjections ! =4_0?~conjunction ! =4_0?~determiner ! =4_0?~qwords ! =5'_0=Pearl ! =4_0?~pronoun_possessive ! =5'_0=world `
^console_log o 2097152 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 2097152 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 2097152 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 2097152 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 2097152 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 2097152 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 2097152 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 2097152 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 2097152 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 2097152 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^getshortexpertsingular o 2097152 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^getshortexpertplural o 2097152 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { Experts } 004 `
^getexpertplural o 2097152 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { Experts } 004 `
^nextgambit o 2097152 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 2097152 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 2097152 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 2097152 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 2097152 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 2097152 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 2097152 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 2097152 0 A( $_tmp ) ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 2097152 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 2097152 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 2097152 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 2097152 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 2097152 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 2097152 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 2097152 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 2097152 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 2097152 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 2097152 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 2097152 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 2097152 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 2097152 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 2097152 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^legalpetname p 2097152 0 A( ) ! =4_0?~number ! =4_0?~pronoun ! =4_0?~interjections ! =4_0?~conjunction ! =4_0?~determiner ! =4_0?~qwords ! =5'_0=Pearl ! =4_0?~pronoun_possessive ! =5'_0=world `
^console_log o 4194304 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 4194304 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 4194304 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 4194304 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 4194304 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 4194304 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 4194304 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 4194304 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 4194304 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 4194304 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^getshortexpertsingular o 4194304 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^getshortexpertplural o 4194304 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { Experts } 004 `
^getexpertplural o 4194304 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { Experts } 004 `
^nextgambit o 4194304 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 4194304 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 4194304 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 4194304 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 4194304 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 4194304 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 4194304 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 4194304 0 A( $_tmp ) ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 4194304 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 4194304 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 4194304 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 4194304 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 4194304 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 4194304 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 4194304 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 4194304 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 4194304 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 4194304 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 4194304 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 4194304 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 4194304 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 4194304 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^legalpetname p 4194304 0 A( ) ! =4_0?~number ! =4_0?~pronoun ! =4_0?~interjections ! =4_0?~conjunction ! =4_0?~determiner ! =4_0?~qwords ! =5'_0=Pearl ! =4_0?~pronoun_possessive ! =5'_0=world `
^console_log o 8388608 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 8388608 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 8388608 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 8388608 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 8388608 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 8388608 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 8388608 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 8388608 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 8388608 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 8388608 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^getshortexpertsingular o 8388608 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^getshortexpertplural o 8388608 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { Experts } 004 `
^getexpertplural o 8388608 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { Experts } 004 `
^nextgambit o 8388608 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 8388608 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 8388608 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 8388608 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 8388608 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 8388608 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 8388608 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 8388608 0 A( $_tmp ) ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 8388608 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 8388608 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 8388608 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 8388608 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 8388608 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 8388608 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 8388608 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 8388608 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 8388608 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 8388608 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 8388608 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 8388608 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 8388608 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 8388608 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^legalpetname p 8388608 0 A( ) ! =4_0?~number ! =4_0?~pronoun ! =4_0?~interjections ! =4_0?~conjunction ! =4_0?~determiner ! =4_0?~qwords ! =5'_0=Pearl ! =4_0?~pronoun_possessive ! =5'_0=world `
^console_log o 8192 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 8192 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 8192 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 8192 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 8192 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 8192 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 8192 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 8192 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 8192 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 8192 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertsingular o 8192 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertplural o 8192 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^getexpertplural o 8192 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^nextgambit o 8192 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 8192 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 8192 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 8192 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 8192 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 8192 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 8192 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 8192 0 A( $_tmp ) ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 8192 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 8192 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 8192 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 8192 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 8192 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 8192 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 8192 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 8192 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 8192 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 8192 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 8192 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 8192 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 8192 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 8192 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^console_log o 67108864 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 67108864 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 67108864 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 67108864 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 67108864 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 67108864 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 67108864 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 67108864 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 67108864 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 67108864 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^getshortexpertsingular o 67108864 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^getshortexpertplural o 67108864 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { Experts } 004 `
^getexpertplural o 67108864 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { Experts } 004 `
^nextgambit o 67108864 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 67108864 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 67108864 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 67108864 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 67108864 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 67108864 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 67108864 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 67108864 0 A( $_tmp ) ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 67108864 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 67108864 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 67108864 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 67108864 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 67108864 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 67108864 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 67108864 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 67108864 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 67108864 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 67108864 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 67108864 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 67108864 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 67108864 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 67108864 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^legalpetname p 67108864 0 A( ) ! =4_0?~number ! =4_0?~pronoun ! =4_0?~interjections ! =4_0?~conjunction ! =4_0?~determiner ! =4_0?~qwords ! =5'_0=Pearl ! =4_0?~pronoun_possessive ! =5'_0=world `
^console_log o 134217728 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 134217728 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 134217728 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 134217728 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 134217728 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 134217728 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 134217728 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 134217728 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 134217728 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 134217728 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^getshortexpertsingular o 134217728 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^getshortexpertplural o 134217728 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { Experts } 004 `
^getexpertplural o 134217728 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { Experts } 004 `
^nextgambit o 134217728 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 134217728 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 134217728 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 134217728 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 134217728 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 134217728 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 134217728 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 134217728 0 A( $_tmp ) ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 134217728 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 134217728 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 134217728 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 134217728 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 134217728 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 134217728 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 134217728 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 134217728 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 134217728 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 134217728 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 134217728 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 134217728 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 134217728 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 134217728 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^legalpetname p 134217728 0 A( ) ! =4_0?~number ! =4_0?~pronoun ! =4_0?~interjections ! =4_0?~conjunction ! =4_0?~determiner ! =4_0?~qwords ! =5'_0=Pearl ! =4_0?~pronoun_possessive ! =5'_0=world `
^console_log o 16777216 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^getexpertcapitalized o 16777216 0 C( ^category ^specialty ) ^if 00c( ! ^1 ) 00z{ $$specialtyfactname = * } 00Y else ( 1 ) 00I { $$specialtyfactname = $specialty } 004 $$factkey = ^join ( ^0 _ $$specialtyfactname ) ^if 00W( ^query ( direct_sv $$factkey expertcapitalized ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { Expert } 004 `
^get_topic_with_sufix o 16777216 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 16777216 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 16777216 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 16777216 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 16777216 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 16777216 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 16777216 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 16777216 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 16777216 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertsingular o 16777216 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertplural o 16777216 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^getexpertplural o 16777216 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^nextgambit o 16777216 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 16777216 0 B( ^symptom ) $symptom = ^0 ^createfact ( $symptom symptomlist x ) `
^hassymptom d 16777216 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^oob o 16777216 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 16777216 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 16777216 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 16777216 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 16777216 0 A( $_tmp ) ^delete ( $holder ) $holder = null $data = null $symptoms = null ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $questionprice = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 16777216 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $questionprice = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^askquestion o 16777216 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 16777216 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 16777216 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 16777216 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^petreference o 16777216 0 A( ) ^if 00v( $petname and %rand < 50 ) 00k{ $petname } 05n else 00m( $petsex == she ) 00f{ her } 04U else 00l( $petsex == he ) 00f{ him } 04f else 00g( $petname ) 00k{ $petname } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 16777216 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 16777216 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 16777216 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 16777216 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) ^if 00s( %response == $_count ) 00#{ $currentexperttopic = ~generic_expert ^nextgambit ( ) } 004 `
^car_reference o 16777216 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^console_log o 16384 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 16384 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 16384 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 16384 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 16384 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 16384 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 16384 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 16384 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 16384 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 16384 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertsingular o 16384 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertplural o 16384 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^getexpertplural o 16384 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^nextgambit o 16384 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 00U{ ^gambit_safe ( $currentexperttopic $source ) } 004 `
^setsymptom o 16384 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 16384 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 16384 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 16384 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 16384 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 16384 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 16384 0 A( $_tmp ) ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 16384 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 16384 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 16384 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 16384 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 16384 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 16384 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 16384 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 16384 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 16384 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 16384 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 16384 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 16384 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 16384 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 16384 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
^console_log o 32768 0 B( ^text ) ^log ( OUTPUT_ECHO "^\nLOG: ^0\n" ) `
^get_topic_with_sufix o 32768 0 C( ^topic ^sufix $_tmp $_pure_topic_name_length ) $_tmp = ^0 ^if 00B( ^extract ( $_tmp 0 1 ) == "~" ) 03l{ ^if 00v( ^findtext ( $_tmp ~ 1 ) ) 02l{ $_pure_topic_name_length = ^findtext ( $_tmp ~ 1 ) - 1 ^if 00A( $_pure_topic_name_length > 0 ) 00#{ $_tmp = ^extract ( $_tmp 0 $_pure_topic_name_length ) } 004 } 004 $_tmp = ^join ( $_tmp _ ^1 ) } 004 ^return ( $_tmp ) `
^respond_safe o 32768 0 C( ^topic ^sufix $_response ) $_response = %response ^if 00a( ^1 ) 00={ ^nofail ( TOPIC ^respond ( ^get_topic_with_sufix ( ^0 ^1 ) ) ) } 004 ^if 00v( $_response == %response ) 00M{ ^nofail ( TOPIC ^respond ( "^^0" ) ) } 004 `
^gambit_safe o 32768 0 C( ^topic ^sufix $_response $_topic_with_sufix ) $_response = %response ^if 00a( ^1 ) 02j{ $_topic_with_sufix = ^get_topic_with_sufix ( ^0 ^1 ) ^if 00F( ^hasgambit ( $_topic_with_sufix ) ) 00Y{ ^nofail ( TOPIC ^gambit ( $_topic_with_sufix ) ) } 004 } 004 ^if 00v( $_response == %response ) 00L{ ^nofail ( TOPIC ^gambit ( "^^0" ) ) } 004 `
^get_canonical o 32768 0 B( ^name ) $$lowecased = ^pos ( lowercase ^0 ) ^if 00S( ^query ( direct_sv $$lowecased canonical ? 1 ) ) 00k{ @0object } 00X else ( 1 ) 00H { ^pos ( capitalize $$lowecased ) } 004 `
^get_model_if_brand_matches_or_null o 32768 0 C( ^model ^brand ) ^if 00c( ! ^1 ) 00s{ ^return ( null ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00s{ ^return ( null ) } 004 ^if 00t( @0object == $$lcbrand ) 00Q{ ^return ( ^get_canonical ( $$lcmodel ) ) } 004 ^return ( null ) `
^get_os_if_brand_macthes_or_default o 32768 0 D( ^model ^brand ^os ) ^if 00c( ! ^1 ) 00q{ ^return ( ^2 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) $$lcbrand = ^pos ( lowercase ^1 ) ^if 00R( ! ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00q{ ^return ( ^2 ) } 004 ^if 00t( @0object != $$lcbrand ) 00q{ ^return ( ^2 ) } 004 ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^2 ) `
^get_brand_or_default o 32768 0 C( ^model ^brand ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00P( ^query ( direct_sv $$lcmodel instance ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^get_os_or_default o 32768 0 C( ^model ^os ) ^if 00c( ! ^0 ) 00q{ ^return ( ^1 ) } 004 $$lcmodel = ^pos ( lowercase ^0 ) ^if 00N( ^query ( direct_sv $$lcmodel use_os ? 1 ) ) 00P{ ^return ( ^get_canonical ( @0object ) ) } 004 ^return ( ^1 ) `
^getexpert o 32768 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00R( ^query ( direct_sv ^0 $_specialtyfactname ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertsingular o 32768 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 012( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertsingular ? ) ) 00k{ @0object } 00y else ( 1 ) 00i { expert } 004 `
^getshortexpertplural o 32768 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 010( ^query ( direct_sv "^^0\_$_specialtyfactname" shortexpertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^getexpertplural o 32768 0 C( ^category ^specialty $_specialtyfactname ) ^if 00c( ! ^1 ) 00z{ $_specialtyfactname = * } 00Y else ( 1 ) 00I { $_specialtyfactname = $specialty } 004 ^if 00*( ^query ( direct_sv "^^0\_$_specialtyfactname" expertplural ? ) ) 00k{ @0object } 00z else ( 1 ) 00j { experts } 004 `
^nextgambit o 32768 0 A( ) ^if 00C( ! %more and ! %outputrejoinder ) 021{ ^if 00w( $chattype == waitingroom ) 00A{ ^gambit ( ~waitingroom ) } 00- else ( 1 ) 00U { ^gambit_safe ( $currentexperttopic $source ) } 004 } 004 `
^setsymptom o 32768 0 B( ^symptom ) $symptom = ^0 ^respond ( ~acquireinput ) `
^setsymptominput o 32768 0 C( ^symptom ^inputsymptom ) $symptom = ^0 ^createfact ( $symptom symptomlist ^1 ) `
^oob o 32768 0 B( ^what ) ^if 00d( $$oob ) 00v{ $$oob = ^"$$oob|^0" } 00C else ( 1 ) 00m { $$oob = ^0 } 004 `
^alarm o 32768 0 B( ^time ) ^oob ( "^alarm=^0" ) `
^oobrule o 32768 0 C( ^time ^rule ) ^oob ( "^callback=^0" ) $callbackrule = ^1 `
^oobstory o 32768 0 C( ^time ^story ) ^oob ( "^loopback=^0" ) $loopbackstory = ^1 `
^restartmain o 32768 0 A( $_tmp ) ^keep ( ) ^reset ( TOPIC * ) ^query ( direct_vo ? member '~categorylist ) ^loop ( -1 ) 01e { $_tmp = ^first ( @0subject ) ^nofail ( RULE ^reuse ( "^~$_tmp\_expert.RESET" ) ) } ^alarm ( 0 ) ^oob ( loopback=0 ) $finalask = null $symptom = null $symptomreact = null $chatbotcounter = null $urgent = null $endgame = null $question = null $questionturn = null $questionasked = null $location = null $sympathy = null $chattype = null $category = null $expert = null $currentexperttopic = null $specialty = null $shortexpertsingular = null $shortexpertplural = null $car_make = null $car_model = null $car_year = null $intent = null $loopbackstory = null $callbackrule = null $callbacktopic = null @0 = ^query ( direct_sv input output ? ) ^delete ( @0 ) `
^restart o 32768 0 A( ) ^keep ( ) ^restartmain ( ) $troublesomeclient = null $total_words = null $location = null $animal = null $bodypart = null $whichcount = null $question = null $agekind = null $urgent = null $usedname = null $caryear = null $model = null ^if 00H( ^query ( direct_sv input output ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00G( ^query ( direct_sv user expert ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? symptomlist ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00I( ^query ( direct_sv bodypart data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00M( ^query ( direct_sv bodypartlist data ? ) ) 00q{ ^delete ( @0 ) } 004 ^if 00H( ^query ( direct_v ? inferexpert ? ) ) 00q{ ^delete ( @0 ) } 004 `
^hassymptom d 32768 0 B( ^symptom ) ^query ( direct_sv ^0 symptomlist ? -1 ? @0 ) `
^showfacts o 32768 0 A( $_tmp ) @0 = ^query ( direct_v ? symptomlist ? ) @1 = ^unduplicate ( @0object ) ^if 00a( @1 ) 012{ ^loop ( -1 ) 00R { $_tmp = ^last ( @1object ) ^"\n\t \"$_tmp\"" } } 004 `
^askquestion o 32768 0 B( ^what ) $question = ^0 $questionturn = %input + 1 `
^whereborn p 32768 0 B( ^who ) [ ( << what [ nation country nationality citizen ] ^0 >> ) ( << where ^0 [ from born hometown home_town birthplace ] >> ) ( << ^0 [ birthplace hometown home_town ] >> ) ( << ^0 native [ city town village nation country ] >> ) ] `
^do_you_like p 32768 0 B( ^what ) ![ or ~qwords ] do * you * ~like * ^0 `
^addressclientonce o 32768 0 A( ) ^if 00z( $clientname and ! $usedname ) 00D{ , $clientname $usedname = 1 } 004 `
^displaylearning o 32768 0 A( ) \n The animal is a $petsex ^if 00f( $petage ) 00n{ $petage old } 004 ^if 00e( $breed ) 00i{ $breed } 004 $animal ^if 00g( $petname ) 00q{ named $petname } 004 . ^showfacts ( ) `
^petreference o 32768 0 A( ) ^if 00v( $petname and %rand < 50 ) 00D{ ^pos ( uppercase $petname ) } 05G else 00m( $petsex == she ) 00f{ her } 050 else 00l( $petsex == he ) 00f{ him } 04y else 00g( $petname ) 00D{ ^pos ( uppercase $petname ) } 03N else 00e( $breed ) 00p{ $owner $breed } 035 else 00r( $agekind and $owner ) 00r{ $owner $agekind } 02l else 00g( $agekind ) 00o{ the $agekind } 01P else 00e( $owner ) 00q{ $owner $animal } 016 else 00f( $animal ) 00n{ the $animal } 00C else ( 1 ) 00m { the animal } 004 `
^sexreference o 32768 0 A( ) ^if 00n( $petsex == male ) 00f{ his } 01c else 00p( $petsex == female ) 00f{ her } 00G else ( 1 ) 00q { $animal == cat ) 004 { his } else { his } `
^subtopic o 32768 0 B( ^topic ) $maintopic = ^getrule ( TOPIC ~ ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^maintopic o 32768 0 B( ^topic ) $currentexperttopic = ^0 ^gambit_safe ( $currentexperttopic $source ) `
^setexpert o 32768 0 B( ^expert $_count ) $currentexperttopic = ^substitute ( character ^0 _specialist _expert ) $expert = ^substitute ( character ^0 _specialist "" ) $expert = ^substitute ( character $expert ~ "" ) ^print ( I can help you talk to the $expert . ) $_count = %response ^nextgambit ( ) `
^car_reference o 32768 0 A( ) ^if 00H( $caryear > 1930 and $caryear < 2000 ) 00s{ $caryear -= 1900 } 00Z else 00o( $caryear >= 2000 ) 00s{ $caryear -= 2000 } 004 ^if 00g( $caryear ) 01w{ ^if 00x( ^length ( $caryear ) == 1 ) 00z{ $caryear = ^"0$caryear" } 004 $caryear = ^"'$caryear" } 004 ^if 00e( $model ) 00w{ your $caryear $model } 01t else 00i( $specialty ) 00A{ your $caryear $specialty } 00J else ( 1 ) 00t { your $caryear car } 004 `
